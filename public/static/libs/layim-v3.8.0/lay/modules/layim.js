/**

 @Name：layim v3.8.0 Pro 商用版
 @Author：贤心
 @Site：http://layim.layui.com
 @License：LGPL
    
 */layui.define(["layer","laytpl","upload"],function(a){var b=layui.$,c=layui.layer,d=layui.laytpl,e=layui.device(),f="layui-show",g="layim-this",h=20,j={},k=function(){this.v="3.8.0",b("body").on("click","*[layim-event]",function(a){var c=b(this),d=c.attr("layim-event");ba[d]?ba[d].call(this,c,a):""})};k.prototype.config=function(a){var c=[];if(layui.each([,,,,,],function(a){c.push(layui.cache.dir+"css/modules/layim/skin/"+(a+1)+".jpg")}),a=a||{},a.skin=a.skin||[],layui.each(a.skin,function(a,b){c.unshift(b)}),a.skin=c,a=b.extend({isfriend:!0,isgroup:!0,voice:"default.mp3"},a),window.JSON&&window.JSON.parse)return y(a),this},k.prototype.on=function(a,b){return"function"==typeof b&&(j[a]?j[a].push(b):j[a]=[b]),this},k.prototype.cache=function(){return x},k.prototype.chat=function(a){return window.JSON&&window.JSON.parse?(C(a),this):void 0},k.prototype.setChatMin=function(){return F(),this},k.prototype.setChatStatus=function(a){var b=J();if(b){var c=b.elem.find(".layim-chat-status");return c.html(a),this}},k.prototype.getMessage=function(a){return Q(a),this},k.prototype.notice=function(a){return N(a),this},k.prototype.add=function(a){return G(a),this},k.prototype.setFriendGroup=function(a){return G(a,"setGroup"),this},k.prototype.msgbox=function(a){return S(a),this},k.prototype.addList=function(a){return V(a),this},k.prototype.removeList=function(a){return W(a),this},k.prototype.setFriendStatus=function(a,c){var d=b(".layim-friend"+a);d["online"===c?"removeClass":"addClass"]("layim-list-gray")},k.prototype.content=function(a){return layui.data.content(a)};//主模板
var l=function(a){return a=a||{},a.item=a.item||"d."+a.type,["{{# var length = 0; layui.each("+a.item+", function(i, data){ length++; }}","<li layim-event=\"chat\" data-type=\""+a.type+"\" data-index=\"{{ "+(a.index||"i")+" }}\" class=\"layim-"+("history"===a.type?"{{i}}":a.type+"{{data.id}}")+" {{ data.status === \"offline\" ? \"layim-list-gray\" : \"\" }}\"><img src=\"{{ data.avatar }}\"><span>{{ data.username||data.groupname||data.name||\"\u4F5A\u540D\" }}</span><p>{{ data.remark||data.sign||\"\" }}</p><span class=\"layim-msg-status\">new</span></li>","{{# }); if(length === 0){ }}","<li class=\"layim-null\">"+({friend:"\u8BE5\u5206\u7EC4\u4E0B\u6682\u65E0\u597D\u53CB",group:"\u6682\u65E0\u7FA4\u7EC4",history:"\u6682\u65E0\u5386\u53F2\u4F1A\u8BDD"}[a.type]||"\u6682\u65E0\u6570\u636E")+"</li>","{{# } }}"].join("")},m=["<div class=\"layui-layim-main\">","<div class=\"layui-layim-info\">","<div class=\"layui-layim-user\">{{ d.mine.username }}</div>","<div class=\"layui-layim-status\">","{{# if(d.mine.status === \"online\"){ }}","<span class=\"layui-icon layim-status-online\" layim-event=\"status\" lay-type=\"show\">&#xe617;</span>","{{# } else if(d.mine.status === \"hide\") { }}","<span class=\"layui-icon layim-status-hide\" layim-event=\"status\" lay-type=\"show\">&#xe60f;</span>","{{# } }}","<ul class=\"layui-anim layim-menu-box\">","<li {{d.mine.status === \"online\" ? \"class=layim-this\" : \"\"}} layim-event=\"status\" lay-type=\"online\"><i class=\"layui-icon\">&#xe605;</i><cite class=\"layui-icon layim-status-online\">&#xe617;</cite>\u5728\u7EBF</li>","<li {{d.mine.status === \"hide\" ? \"class=layim-this\" : \"\"}} layim-event=\"status\" lay-type=\"hide\"><i class=\"layui-icon\">&#xe605;</i><cite class=\"layui-icon layim-status-hide\">&#xe60f;</cite>\u9690\u8EAB</li>","</ul>","</div>","<input class=\"layui-layim-remark\" placeholder=\"\u7F16\u8F91\u7B7E\u540D\" value=\"{{ d.mine.remark||d.mine.sign||\"\" }}\">","</div>","<ul class=\"layui-unselect layui-layim-tab{{# if(!d.base.isfriend || !d.base.isgroup){ }}"," layim-tab-two","{{# } }}\">","<li class=\"layui-icon","{{# if(!d.base.isfriend){ }}"," layim-hide","{{# } else { }}"," layim-this","{{# } }}","\" title=\"\u8054\u7CFB\u4EBA\" layim-event=\"tab\" lay-type=\"friend\">&#xe612;</li>","<li class=\"layui-icon","{{# if(!d.base.isgroup){ }}"," layim-hide","{{# } else if(!d.base.isfriend) { }}"," layim-this","{{# } }}","\" title=\"\u7FA4\u7EC4\" layim-event=\"tab\" lay-type=\"group\">&#xe613;</li>","<li class=\"layui-icon\" title=\"\u5386\u53F2\u4F1A\u8BDD\" layim-event=\"tab\" lay-type=\"history\">&#xe611;</li>","</ul>","<ul class=\"layui-unselect layim-tab-content {{# if(d.base.isfriend){ }}layui-show{{# } }} layim-list-friend\">","{{# layui.each(d.friend, function(index, item){ var spread = d.local[\"spread\"+index]; }}","<li>","<h5 layim-event=\"spread\" lay-type=\"{{ spread }}\"><i class=\"layui-icon\">{{# if(spread === \"true\"){ }}&#xe61a;{{# } else {  }}&#xe602;{{# } }}</i><span>{{ item.groupname||\"\u672A\u547D\u540D\u5206\u7EC4\"+index }}</span><em>(<cite class=\"layim-count\"> {{ (item.list||[]).length }}</cite>)</em></h5>","<ul class=\"layui-layim-list {{# if(spread === \"true\"){ }}"," layui-show","{{# } }}\">",l({type:"friend",item:"item.list",index:"index"}),"</ul>","</li>","{{# }); if(d.friend.length === 0){ }}","<li><ul class=\"layui-layim-list layui-show\"><li class=\"layim-null\">\u6682\u65E0\u8054\u7CFB\u4EBA</li></ul>","{{# } }}","</ul>","<ul class=\"layui-unselect layim-tab-content {{# if(!d.base.isfriend && d.base.isgroup){ }}layui-show{{# } }}\">","<li>","<ul class=\"layui-layim-list layui-show layim-list-group\">",l({type:"group"}),"</ul>","</li>","</ul>","<ul class=\"layui-unselect layim-tab-content  {{# if(!d.base.isfriend && !d.base.isgroup){ }}layui-show{{# } }}\">","<li>","<ul class=\"layui-layim-list layui-show layim-list-history\">",l({type:"history"}),"</ul>","</li>","</ul>","<ul class=\"layui-unselect layim-tab-content\">","<li>","<ul class=\"layui-layim-list layui-show\" id=\"layui-layim-search\"></ul>","</li>","</ul>","<ul class=\"layui-unselect layui-layim-tool\">","<li class=\"layui-icon layim-tool-search\" layim-event=\"search\" title=\"\u641C\u7D22\">&#xe615;</li>","{{# if(d.base.msgbox){ }}","<li class=\"layui-icon layim-tool-msgbox\" layim-event=\"msgbox\" title=\"\u6D88\u606F\u76D2\u5B50\">&#xe645;<span class=\"layui-anim\"></span></li>","{{# } }}","{{# if(d.base.find){ }}","<li class=\"layui-icon layim-tool-find\" layim-event=\"find\" title=\"\u67E5\u627E\">&#xe608;</li>","{{# } }}","<li class=\"layui-icon layim-tool-skin\" layim-event=\"skin\" title=\"\u66F4\u6362\u80CC\u666F\">&#xe61b;</li>","{{# if(!d.base.copyright){ }}","<li class=\"layui-icon layim-tool-about\" layim-event=\"about\" title=\"\u5173\u4E8E\">&#xe60b;</li>","{{# } }}","</ul>","<div class=\"layui-layim-search\"><input><label class=\"layui-icon\" layim-event=\"closeSearch\">&#x1007;</label></div>","</div>"].join(""),n="<div class=\"layim-chat layim-chat-{{d.data.type}}{{d.first ? \" layui-show\" : \"\"}}\"><div class=\"layui-unselect layim-chat-title\"><div class=\"layim-chat-other\"><img class=\"layim-{{ d.data.type }}{{ d.data.id }}\" src=\"{{ d.data.avatar }}\"><span class=\"layim-chat-username\" layim-event=\"{{ d.data.type===\"group\" ? \"groupMembers\" : \"\" }}\">{{ d.data.name||\"\u4F5A\u540D\" }} {{d.data.temporary ? \"<cite>\u4E34\u65F6\u4F1A\u8BDD</cite>\" : \"\"}} {{# if(d.data.type===\"group\"){ }} <em class=\"layim-chat-members\"></em><i class=\"layui-icon\">&#xe61a;</i> {{# } }}</span><p class=\"layim-chat-status\"></p></div></div><div class=\"layim-chat-main\"><ul></ul></div><div class=\"layim-chat-footer\"><div class=\"layui-unselect layim-chat-tool\" data-json=\"{{encodeURIComponent(JSON.stringify(d.data))}}\"><span class=\"layui-icon layim-tool-face\" title=\"\u9009\u62E9\u8868\u60C5\" layim-event=\"face\">&#xe60c;</span>{{# if(d.base && d.base.uploadImage){ }}<span class=\"layui-icon layim-tool-image\" title=\"\u4E0A\u4F20\u56FE\u7247\" layim-event=\"image\">&#xe60d;<input type=\"file\" name=\"file\"></span>{{# }; }}{{# if(d.base && d.base.uploadFile){ }}<span class=\"layui-icon layim-tool-image\" title=\"\u53D1\u9001\u6587\u4EF6\" layim-event=\"image\" data-type=\"file\">&#xe61d;<input type=\"file\" name=\"file\"></span>{{# }; }}{{# if(d.base && d.base.isAudio){ }}<span class=\"layui-icon layim-tool-audio\" title=\"\u53D1\u9001\u7F51\u7EDC\u97F3\u9891\" layim-event=\"media\" data-type=\"audio\">&#xe6fc;</span>{{# }; }}{{# if(d.base && d.base.isVideo){ }}<span class=\"layui-icon layim-tool-video\" title=\"\u53D1\u9001\u7F51\u7EDC\u89C6\u9891\" layim-event=\"media\" data-type=\"video\">&#xe6ed;</span>{{# }; }}{{# layui.each(d.base.tool, function(index, item){ }}<span class=\"layui-icon layim-tool-{{item.alias}}\" title=\"{{item.title}}\" layim-event=\"extend\" lay-filter=\"{{ item.alias }}\">{{item.icon}}</span>{{# }); }}{{# if(d.base && d.base.chatLog){ }}<span class=\"layim-tool-log\" layim-event=\"chatLog\"><i class=\"layui-icon\">&#xe60e;</i>\u804A\u5929\u8BB0\u5F55</span>{{# }; }}</div><div class=\"layim-chat-textarea\"><textarea></textarea></div><div class=\"layim-chat-bottom\"><div class=\"layim-chat-send\">{{# if(!d.base.brief){ }}<span class=\"layim-send-close\" layim-event=\"closeThisChat\">\u5173\u95ED</span>{{# } }}<span class=\"layim-send-btn\" layim-event=\"send\">\u53D1\u9001</span><span class=\"layim-send-set\" layim-event=\"setSend\" lay-type=\"show\"><em class=\"layui-edge\"></em></span><ul class=\"layui-anim layim-menu-box\"><li {{d.local.sendHotKey !== \"Ctrl+Enter\" ? \"class=layim-this\" : \"\"}} layim-event=\"setSend\" lay-type=\"Enter\"><i class=\"layui-icon\">&#xe618;</i>\u6309Enter\u952E\u53D1\u9001\u6D88\u606F</li><li {{d.local.sendHotKey === \"Ctrl+Enter\" ? \"class=layim-this\" : \"\"}} layim-event=\"setSend\"  lay-type=\"Ctrl+Enter\"><i class=\"layui-icon\">&#xe618;</i>\u6309Ctrl+Enter\u952E\u53D1\u9001\u6D88\u606F</li></ul></div></div></div></div>",o=["<li {{ d.mine ? \"class=layim-chat-mine\" : \"\" }} {{# if(d.cid){ }}data-cid=\"{{d.cid}}\"{{# } }}>","<div class=\"layim-chat-user\"><img src=\"{{ d.avatar }}\"><cite>","{{# if(d.mine){ }}","<i>{{ layui.data.date(d.timestamp) }}</i>{{ d.username||\"\u4F5A\u540D\" }}","{{# } else { }}","{{ d.username||\"\u4F5A\u540D\" }}<i>{{ layui.data.date(d.timestamp) }}</i>","{{# } }}","</cite></div>","<div class=\"layim-chat-text\" style=\"position:relative;max-width: 350px;\">","<img class=\"messagefail_img\" src=\"https://i.loli.net/2019/04/12/5cb04b95be706.png\" />","<div {{ d.type != \"group\"? \"\": \"style=display:none;\" }} class=\"x-msg-del\">x</div>","<div class=\"contextmenuul\">","<div class=\"contextli\"><a><span class=\"layui-icon layui-icon-file\"></span>\u590D\u5236</a></div>","<div class=\"contextulline\"></div>","<div class=\"contextli\"><a><span class=\"layui-icon layui-icon-delete\"></span>\u5220\u9664</a></div>","</div>","{{ layui.data.content(d.content||\"&nbsp\") }}</div>",,// '<div style="display:flex;flex-direction:column;align-items:center" ><div style="background-color:#DADADA;padding:10px;font-size: 13px;color: white;margin-top:25px">消息发送失败，请稍后重试</div></div>'
"</li>"].join(""),p="<li class=\"layim-{{ d.data.type }}{{ d.data.id }} layim-chatlist-{{ d.data.type }}{{ d.data.id }} layim-this\" layim-event=\"tabChat\"><img src=\"{{ d.data.avatar }}\"><span>{{ d.data.name||\"\u4F5A\u540D\" }}</span>{{# if(!d.base.brief){ }}<i class=\"layui-icon\" layim-event=\"closeChat\">&#x1007;</i>{{# } }}</li>",q=function(a){return 10>a?"0"+(0|a):a};layui.data.date=function(a){var b=new Date(a||new Date);return b.getFullYear()+"-"+q(b.getMonth()+1)+"-"+q(b.getDate())+" "+q(b.getHours())+":"+q(b.getMinutes())+":"+q(b.getSeconds())},layui.data.content=function(a){//支持的html标签
var b=function(a){return new RegExp("\\n*\\["+(a||"")+"(code|pre|div|span|p|table|thead|th|tbody|tr|td|ul|li|ol|li|dl|dt|dd|h2|h3|h4|h5)([\\s\\S]*?)\\]\\n*","g")};//转义换行 
return a=(a||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")//XSS
.replace(/@(\S+)(\s+?|$)/g,"@<a href=\"javascript:;\">$1</a>$2")//转义@
.replace(/face\[([^\s\[\]]+?)\]/g,function(a){//转义表情
var b=a.replace(/^face/g,"");return"<img alt=\""+b+"\" title=\""+b+"\" src=\""+Z[b]+"\">"}).replace(/img\[([^\s]+?)\]/g,function(a){//转义图片
return"<img class=\"layui-layim-photos\" src=\""+a.replace(/(^img\[)|(\]$)/g,"")+"\">"}).replace(/file\([\s\S]+?\)\[[\s\S]*?\]/g,function(a){//转义文件
var b=(a.match(/file\(([\s\S]+?)\)\[/)||[])[1],c=(a.match(/\)\[([\s\S]*?)\]/)||[])[1];return b?"<a class=\"layui-layim-file\" href=\""+b+"\" download target=\"_blank\"><i class=\"layui-icon\">&#xe61e;</i><cite>"+(c||b)+"</cite></a>":a}).replace(/audio\[([^\s]+?)\]/g,function(a){//转义音频
return"<div class=\"layui-unselect layui-layim-audio\" layim-event=\"playAudio\" data-src=\""+a.replace(/(^audio\[)|(\]$)/g,"")+"\"><i class=\"layui-icon\">&#xe652;</i><p>\u97F3\u9891\u6D88\u606F</p></div>"}).replace(/video\[([^\s]+?)\]/g,function(a){//转义音频
return"<div class=\"layui-unselect layui-layim-video\" layim-event=\"playVideo\" data-src=\""+a.replace(/(^video\[)|(\]$)/g,"")+"\"><i class=\"layui-icon\">&#xe652;</i></div>"}).replace(/a\([\s\S]+?\)\[[\s\S]*?\]/g,function(a){//转义链接
var b=(a.match(/a\(([\s\S]+?)\)\[/)||[])[1],c=(a.match(/\)\[([\s\S]*?)\]/)||[])[1];return b?"<a href=\""+b+"\" target=\"_blank\">"+(c||b)+"</a>":a}).replace(b(),"<$1 $2>").replace(b("/"),"</$1>")//转移HTML代码
.replace(/\n/g,"<br>"),a};//Ajax
var r,s,t,u,v,w=function(a,d,e){return a=a||{},b.ajax({url:a.url,type:a.type||"get",data:a.data,dataType:a.dataType||"json",cache:!1,success:function(a){0==a.code?d&&d(a.data||{}):c.msg(a.msg||(e||"Error")+": LAYIM_NOT_GET_DATA",{time:5e3})},error:function(a,b){window.console&&console.log&&console.error("LAYIM_DATE_ERROR\uFF1A"+b)}})},x={message:{},chat:[]},y=function(a){var c=a.init||{};return(mine=c.mine||{},local=layui.data("layim")[mine.id]||{},obj={base:a,local:local,mine:mine,history:local.history||{}},create=function(c){var e=c.mine||{},f=layui.data("layim")[e.id]||{},g={base:a//基础配置信息
,local:f//本地数据
,mine:e//我的用户信息
,friend:c.friend||[]//联系人信息
,group:c.group||[]//群组信息
,history:f.history||{}//历史会话信息
};x=b.extend(x,g),z(d(m).render(g)),(f.close||a.min)&&B(),layui.each(j.ready,function(a,b){b&&b(g)})},x=b.extend(x,obj),a.brief)?layui.each(j.ready,function(a,b){b&&b(obj)}):void(c.url?w(c,create,"INIT"):create(c))},z=function(a){return c.open({type:1,area:["260px","520px"],skin:"layui-box layui-layim",title:"&#8203;",offset:"rb",id:"layui-layim",shade:!1,anim:2,resize:!1,content:a,success:function(a){r=a,K(a),x.base.right&&a.css("margin-left","-"+x.base.right),s&&c.close(s.attr("times"));//按最新会话重新排列
var d=[],e=a.find(".layim-list-history");e.find("li").each(function(){d.push(b(this).prop("outerHTML"))}),0<d.length&&(d.reverse(),e.html(d.join(""))),A(),ba.sign()},cancel:function(){B();var a=layui.data("layim")[x.mine.id]||{};return a.close=!0,layui.data("layim",{key:x.mine.id,value:a}),!1}})},A=function(){r.on("contextmenu",function(a){return a.cancelBubble=!0,a.returnValue=!1,!1});var a=function(){c.closeAll("tips")};//自定义历史会话右键菜单
r.find(".layim-list-history").on("contextmenu","li",function(){var d=b(this),e="<ul data-id=\""+d[0].id+"\" data-index=\""+d.data("index")+"\"><li layim-event=\"menuHistory\" data-type=\"one\">\u79FB\u9664\u8BE5\u4F1A\u8BDD</li><li layim-event=\"menuHistory\" data-type=\"all\">\u6E05\u7A7A\u5168\u90E8\u4F1A\u8BDD\u5217\u8868</li></ul>";d.hasClass("layim-null")||(c.tips(e,this,{tips:1,time:0,anim:5,fixed:!0,skin:"layui-box layui-layim-contextmenu",success:function(a){var b=function(a){$(a)};a.off("mousedown",b).on("mousedown",b)}}),b(document).off("mousedown",a).on("mousedown",a),b(window).off("resize",a).on("resize",a))})},B=function(a){return s&&c.close(s.attr("times")),r&&r.hide(),x.mine=x.mine||{},c.open({type:1,title:!1,id:"layui-layim-close",skin:"layui-box layui-layim-min layui-layim-close",shade:!1,closeBtn:!1,anim:2,offset:"rb",resize:!1,content:"<img src=\""+(x.mine.avatar||layui.cache.dir+"css/pc/layim/skin/logo.jpg")+"\"><span>"+(a||x.base.title||"\u6211\u7684LayIM")+"</span>",move:"#layui-layim-close img",success:function(a,b){s=a,x.base.right&&a.css("margin-left","-"+x.base.right),a.on("click",function(){c.close(b),r.show();var a=layui.data("layim")[x.mine.id]||{};delete a.close,layui.data("layim",{key:x.mine.id,value:a})})}})},C=function(a){a=a||{};var e=b("#layui-layim-chat"),f={data:a,base:x.base,local:x.local};if(!a.id)return c.msg("\u975E\u6CD5\u7528\u6237");if(e[0]){var g=t.find(".layim-chat-list"),h=g.find(".layim-chatlist-"+a.type+a.id),i=t.find(".layui-layer-max").hasClass("layui-layer-maxmin"),k=e.children(".layim-chat-box");return"none"===t.css("display")&&t.show(),u&&c.close(u.attr("times")),1!==g.find("li").length||h[0]||(i||t.css("width",800),g.css({height:t.height()}).show(),k.css("margin-left","200px")),h[0]||(g.append(d(p).render(f)),k.append(d(n).render(f)),D(a),E()),H(g.find(".layim-chatlist-"+a.type+a.id)),h[0]||U(),L(a),Y(),v}f.first=!0;var l=v=c.open({type:1,area:"600px",skin:"layui-box layui-layim-chat",id:"layui-layim-chat",title:"&#8203;",shade:!1,maxmin:!0,offset:a.offset||"auto",anim:a.anim||0,closeBtn:!x.base.brief&&1,content:d("<ul class=\"layui-unselect layim-chat-list\">"+p+"</ul><div class=\"layim-chat-box\">"+n+"</div>").render(f),success:function(b){//聊天窗口的切换监听
//查看大图
t=b,b.css({"min-width":"500px","min-height":"420px"}),D(a),"function"==typeof a.success&&a.success(b),Y(),K(b),L(a),U(),I(),layui.each(j.chatChange,function(a,b){b&&b(J())}),b.on("dblclick",".layui-layim-photos",function(){var a=this.src;c.close(C.photosIndex),c.photos({photos:{data:[{alt:"\u5927\u56FE\u6A21\u5F0F",src:a}]},shade:.01,closeBtn:2,anim:0,resize:!1,success:function(a,b){C.photosIndex=b}})})},full:function(){c.style(l,{width:"100%",height:"100%"},!0),E()},resizing:E,restore:E,min:function(){return F(),!1},end:function(){c.closeAll("tips"),t=null}});return l},D=function(a){b(".layim-"+a.type+a.id).each(function(){b(this).hasClass("layim-list-gray")&&layui.layim.setFriendStatus(a.id,"offline")})},E=function(){var a=t.find(".layim-chat-list"),b=t.find(".layim-chat-main"),c=t.height();a.css({height:c}),b.css({height:c-20-80-158})},F=function(a){var d=a||J().data,e=layui.layim.cache().base;t&&!a&&t.hide(),c.close(F.index),F.index=c.open({type:1,title:!1,skin:"layui-box layui-layim-min",shade:!1,closeBtn:!1,anim:d.anim||2,offset:"b",move:"#layui-layim-min",resize:!1,area:["182px","50px"],content:"<img id=\"layui-layim-min\" src=\""+d.avatar+"\"><span>"+d.name+"</span>",success:function(d,f){a||(u=d),e.minRight&&c.style(f,{left:b(window).width()-d.outerWidth()-parseFloat(e.minRight)}),d.find(".layui-layer-content span").on("click",function(){c.close(f),a?layui.each(x.chat,function(a,b){C(b)}):t.show(),a&&(x.chat=[],X())}),d.find(".layui-layer-content img").on("click",function(a){$(a)})}})},G=function(a,b){return a=a||{},c.close(G.index),G.index=c.open({type:1,area:"430px",title:{friend:"\u6DFB\u52A0\u597D\u53CB",group:"\u52A0\u5165\u7FA4\u7EC4"}[a.type]||"",shade:!1,resize:!1,btn:b?["\u786E\u8BA4","\u53D6\u6D88"]:["\u53D1\u9001\u7533\u8BF7","\u5173\u95ED"],content:d("<div class=\"layim-add-box\"><div class=\"layim-add-img\"><img class=\"layui-circle\" src=\"{{ d.data.avatar }}\"><p>{{ d.data.name||\"\" }}</p></div><div class=\"layim-add-remark\">{{# if(d.data.type === \"friend\" && d.type === \"setGroup\"){ }}<p>\u9009\u62E9\u5206\u7EC4</p>{{# } if(d.data.type === \"friend\"){ }}<select class=\"layui-select\" id=\"LAY_layimGroup\">{{# layui.each(d.data.group, function(index, item){ }}<option value=\"{{ item.id }}\">{{ item.groupname }}</option>{{# }); }}</select>{{# } }}{{# if(d.data.type === \"group\"){ }}<p>\u8BF7\u8F93\u5165\u9A8C\u8BC1\u4FE1\u606F</p>{{# } if(d.type !== \"setGroup\"){ }}<textarea id=\"LAY_layimRemark\" placeholder=\"\u9A8C\u8BC1\u4FE1\u606F\" class=\"layui-textarea\"></textarea>{{# } }}</div></div>").render({data:{name:a.username||a.groupname,avatar:a.avatar,group:a.group||parent.layui.layim.cache().friend||[],type:a.type},type:b}),yes:function(c,d){var e=d.find("#LAY_layimGroup"),f=d.find("#LAY_layimRemark");b?a.submit&&a.submit(e.val(),c):a.submit&&a.submit(e.val(),f.val(),c)}})},H=function(a,d){a=a||b(".layim-chat-list ."+g);var e=-1===a.index()?0:a.index(),h=".layim-chat",i=t.find(h).eq(e),k=t.find(".layui-layer-max").hasClass("layui-layer-maxmin");if(d){a.hasClass(g)&&H(0===e?a.next():a.prev());var l=t.find(h).length;//关闭聊天界面
return 1===l?c.close(v):(a.remove(),i.remove(),2===l&&(t.find(".layim-chat-list").hide(),!k&&t.css("width","600px"),t.find(".layim-chat-box").css("margin-left",0)),!1)}//聊天窗口的切换监听
a.addClass(g).siblings().removeClass(g),i.addClass(f).siblings(h).removeClass(f),i.find("textarea").focus(),layui.each(j.chatChange,function(a,b){b&&b(J())}),I()},I=function(){var a=J(),b=x.message[a.data.type+a.data.id];b&&delete x.message[a.data.type+a.data.id]},J=k.prototype.thisChat=function(){if(t){var a=b(".layim-chat-list ."+g).index(),c=t.find(".layim-chat").eq(a),d=JSON.parse(decodeURIComponent(c.find(".layim-chat-tool").data("json")));return{elem:c,data:d,textarea:c.find("textarea")}}},K=function(a){var b=layui.data("layim")[x.mine.id]||{},c=b.skin;a.css({"background-image":c?"url("+c+")":function(){return x.base.initSkin?"url("+(layui.cache.dir+"css/modules/layim/skin/"+x.base.initSkin)+")":"none"}()})},L=function(a){var b=layui.data("layim")[x.mine.id]||{},c={},e=b.history||{},f=e[a.type+a.id];if(r){var g=r.find(".layim-list-history");if(a.historyTime=new Date().getTime(),e[a.type+a.id]=a,b.history=e,layui.data("layim",{key:x.mine.id,value:b}),!f){c[a.type+a.id]=a;var h=d(l({type:"history",item:"d.data"})).render({data:c});g.prepend(h),g.find(".layim-null").remove()}}},M=function(){var a={username:x.mine?x.mine.username:"\u8BBF\u5BA2",avatar:x.mine?x.mine.avatar:layui.cache.dir+"css/pc/layim/skin/logo.jpg",id:x.mine?x.mine.id:null,mine:!0},e=J(),f=e.elem.find(".layim-chat-main ul"),g=x.base.maxLength||3e3;if(a.content=e.textarea.val(),""!==a.content.replace(/\s/g,"")){if(a.content.length>g)return c.msg("\u5185\u5BB9\u6700\u957F\u4E0D\u80FD\u8D85\u8FC7"+g+"\u4E2A\u5B57\u7B26");// change
// ul.append(laytpl(elemChatMain).render(data));
// to
// 调用发送前的回调
var h=b(d(o).render(a));if(j.beforeSendMessage instanceof Array)for(var k=0;k<j.beforeSendMessage.length;k++)// 如果此回调返回值为 false, 表示此消息不发送
if(!j.beforeSendMessage[k](h,e))return;f.append(h);// end
var l={mine:a,to:e.data},m={username:l.mine.username,avatar:l.mine.avatar,id:l.to.id,type:l.to.type,content:l.mine.content,timestamp:new Date().getTime(),mine:!0};T(m),layui.each(j.sendMessage,function(a,b){b&&b(l,h)})}X(),e.textarea.val("").focus()},N=function(a){if(a=a||{},window.Notification)if("granted"===Notification.permission)new Notification(a.title||"",{body:a.content||"",icon:a.avatar||"http://tp2.sinaimg.cn/5488749285/50/5719808192/1"});else Notification.requestPermission()},O=function(){if(!(e.ie&&9>e.ie)){var a=document.createElement("audio");a.src=layui.cache.dir+"css/modules/layim/voice/"+x.base.voice,a.play()}},P={},Q=function(a){a=a||{};var c=b(".layim-chatlist-"+a.type+a.id),e={},f=c.index();if(a.timestamp=a.timestamp||new Date().getTime(),a.fromid==x.mine.id&&(a.mine=!0),a.system||T(a),P=JSON.parse(JSON.stringify(a)),x.base.voice&&O(),!t&&a.content||-1===f){if(x.message[a.type+a.id])x.message[a.type+a.id].push(a);else//记录聊天面板队列
if(x.message[a.type+a.id]=[a],"friend"===a.type){var g;layui.each(x.friend,function(b,c){if(layui.each(c.list,function(b,c){if(c.id==a.id)return c.type="friend",c.name=c.username,x.chat.push(c),g=!0}),g)return!0}),g||(a.name=a.username,a.temporary=!0,x.chat.push(a))}else if("group"===a.type){var h;layui.each(x.group,function(b,c){if(c.id==a.id)return c.type="group",c.name=c.groupname,x.chat.push(c),h=!0}),h||(a.name=a.groupname,x.chat.push(a))}else a.name=a.name||a.username||a.groupname,x.chat.push(a);if("group"===a.type&&layui.each(x.group,function(b,c){if(c.id==a.id)return e.avatar=c.avatar,!0}),!a.system)return x.base.notice&&N({title:"\u6765\u81EA "+a.username+" \u7684\u6D88\u606F",content:a.content,avatar:e.avatar||a.avatar}),F({name:"\u6536\u5230\u65B0\u6D88\u606F",avatar:e.avatar||a.avatar,anim:6})}if(t){//接受到的消息不在当前Tab
var k=J(),l=!0;// addition
// 添加变量, 标记新消息是否在当前窗口
k.data.type+k.data.id!==a.type+a.id&&(l=!1,c.addClass("layui-anim layer-anim-06"),setTimeout(function(){c.removeClass("layui-anim layer-anim-06")},300));var m=t.find(".layim-chat").eq(f),n=m.find(".layim-chat-main ul");//系统消息
if(a.system)-1!==f&&n.append("<li class=\"layim-chat-system\"><span>"+a.content+"</span></li>");else if(""!==a.content.replace(/\s/g,"")){// change
// ul.append(laytpl(elemChatMain).render(data));
// to
var p=b(d(o).render(a));if(j.afterGetMessage instanceof Array)for(var q=0;q<j.afterGetMessage.length;q++)j.afterGetMessage[q](p,l,k,a);n.append(p)}X()}},R="layui-anim-loop layer-anim-05",S=function(a){var b=r.find(".layim-tool-msgbox");b.find("span").addClass(R).html(a)},T=function(a){var b=layui.data("layim")[x.mine.id]||{};b.chatlog=b.chatlog||{};var c=b.chatlog[a.type+a.id];if(c){//避免浏览器多窗口时聊天记录重复保存
var d;layui.each(c,function(b,c){c.timestamp===a.timestamp&&c.type===a.type&&c.id===a.id&&c.content===a.content&&(d=!0)}),d||a.fromid==x.mine.id||c.push(a),c.length>h&&c.shift()}else b.chatlog[a.type+a.id]=[a];layui.data("layim",{key:x.mine.id,value:b})},U=function(){var a=layui.data("layim")[x.mine.id]||{},c=J(),e=a.chatlog||{},f=c.elem.find(".layim-chat-main ul");layui.each(e[c.data.type+c.data.id],function(a,e){// change
// ul.append(laytpl(elemChatMain).render(item));
// to
var g=b(d(o).render(e));if(j.afterGetMessage instanceof Array)for(var h=0;h<j.afterGetMessage.length;h++)j.afterGetMessage[h](g,!0,c,e);f.append(g)}),X()},V=function(a){var b,e={},f=r.find(".layim-list-"+a.type);if(x[a.type])if("friend"===a.type)layui.each(x.friend,function(d,f){if(a.groupid==f.id)return(layui.each(x.friend[d].list,function(c,d){if(d.id==a.id)return b=!0}),b)?c.msg("\u597D\u53CB ["+(a.username||"")+"] \u5DF2\u7ECF\u5B58\u5728\u5217\u8868\u4E2D",{anim:6}):(x.friend[d].list=x.friend[d].list||[],e[x.friend[d].list.length]=a,a.groupIndex=d,x.friend[d].list.push(a),!0)});else if("group"===a.type){if(layui.each(x.group,function(c,d){if(d.id==a.id)return b=!0}),b)return c.msg("\u60A8\u5DF2\u662F ["+(a.groupname||"")+"] \u7684\u7FA4\u6210\u5458",{anim:6});e[x.group.length]=a,x.group.push(a)}if(!b){var g=d(l({type:a.type,item:"d.data",index:"friend"===a.type?"data.groupIndex":null})).render({data:e});if("friend"===a.type){var h=f.find(">li").eq(a.groupIndex);h.find(".layui-layim-list").append(g),h.find(".layim-count").html(x.friend[a.groupIndex].list.length),h.find(".layim-null")[0]&&h.find(".layim-null").remove()}else"group"===a.type&&(f.append(g),f.find(".layim-null")[0]&&f.find(".layim-null").remove())}},W=function(a){var b=r.find(".layim-list-"+a.type);x[a.type]&&("friend"===a.type?layui.each(x.friend,function(c,d){layui.each(d.list,function(d,e){if(a.id==e.id){var f=b.find(">li").eq(c),g=f.find(".layui-layim-list>li");return f.find(".layui-layim-list>li").eq(d).remove(),x.friend[c].list.splice(d,1),f.find(".layim-count").html(x.friend[c].list.length),0===x.friend[c].list.length&&f.find(".layui-layim-list").html("<li class=\"layim-null\">\u8BE5\u5206\u7EC4\u4E0B\u5DF2\u65E0\u597D\u53CB\u4E86</li>"),!0}})}):"group"===a.type&&layui.each(x.group,function(c,d){if(a.id==d.id)return b.find(">li").eq(c).remove(),x.group.splice(c,1),0===x.group.length&&b.html("<li class=\"layim-null\">\u6682\u65E0\u7FA4\u7EC4</li>"),!0}))},X=function(){var a=J(),b=a.elem.find(".layim-chat-main"),c=b.find("ul"),d=c.find("li").length;if(d>=h){var e=c.find("li").eq(0);c.prev().hasClass("layim-chat-system")||c.before("<div class=\"layim-chat-system\"><span layim-event=\"chatLog\">\u67E5\u770B\u66F4\u591A\u8BB0\u5F55</span></div>"),d>h&&e.remove()}b.scrollTop(b[0].scrollHeight+1e3),b.find("ul li:last").find("img").load(function(){b.scrollTop(b[0].scrollHeight+1e3)})},Y=function(){var a=J(),b=a.textarea;b.focus(),b.off("keydown").on("keydown",function(a){var c=layui.data("layim")[x.mine.id]||{},d=a.keyCode;if("Ctrl+Enter"===c.sendHotKey)return void(a.ctrlKey&&13===d&&M());if(13===d){if(a.ctrlKey)return b.val(b.val()+"\n");if(a.shiftKey)return;a.preventDefault(),M()}})},Z=function(){var a={};return layui.each(["[\u5FAE\u7B11]","[\u563B\u563B]","[\u54C8\u54C8]","[\u53EF\u7231]","[\u53EF\u601C]","[\u6316\u9F3B]","[\u5403\u60CA]","[\u5BB3\u7F9E]","[\u6324\u773C]","[\u95ED\u5634]","[\u9119\u89C6]","[\u7231\u4F60]","[\u6CEA]","[\u5077\u7B11]","[\u4EB2\u4EB2]","[\u751F\u75C5]","[\u592A\u5F00\u5FC3]","[\u767D\u773C]","[\u53F3\u54FC\u54FC]","[\u5DE6\u54FC\u54FC]","[\u5618]","[\u8870]","[\u59D4\u5C48]","[\u5410]","[\u54C8\u6B20]","[\u62B1\u62B1]","[\u6012]","[\u7591\u95EE]","[\u998B\u5634]","[\u62DC\u62DC]","[\u601D\u8003]","[\u6C57]","[\u56F0]","[\u7761]","[\u94B1]","[\u5931\u671B]","[\u9177]","[\u8272]","[\u54FC]","[\u9F13\u638C]","[\u6655]","[\u60B2\u4F24]","[\u6293\u72C2]","[\u9ED1\u7EBF]","[\u9634\u9669]","[\u6012\u9A82]","[\u4E92\u7C89]","[\u5FC3]","[\u4F24\u5FC3]","[\u732A\u5934]","[\u718A\u732B]","[\u5154\u5B50]","[ok]","[\u8036]","[good]","[NO]","[\u8D5E]","[\u6765]","[\u5F31]","[\u8349\u6CE5\u9A6C]","[\u795E\u9A6C]","[\u56E7]","[\u6D6E\u4E91]","[\u7ED9\u529B]","[\u56F4\u89C2]","[\u5A01\u6B66]","[\u5965\u7279\u66FC]","[\u793C\u7269]","[\u949F]","[\u8BDD\u7B52]","[\u8721\u70DB]","[\u86CB\u7CD5]"],function(b,c){a[c]=layui.cache.dir+"images/face/"+b+".gif"}),a}(),$=layui.stope,_=function(a,b){var c,d=a.value;a.focus(),document.selection?(c=document.selection.createRange(),document.selection.empty(),c.text=b):(c=[d.substring(0,a.selectionStart),b,d.substr(a.selectionEnd)],a.focus(),a.value=c.join(""))},aa="layui-anim-upbit",ba={//在线状态
status:function(a,c){var d=function(){a.next().hide().removeClass(aa)},e=a.attr("lay-type");if("show"===e)$(c),a.next().show().addClass(aa),b(document).off("click",d).on("click",d);else{var f=a.parent().prev();a.addClass(g).siblings().removeClass(g),f.html(a.find("cite").html()),f.removeClass("layim-status-"+("online"===e?"hide":"online")).addClass("layim-status-"+e),layui.each(j.online,function(a,b){b&&b(e)})}}//编辑签名
,sign:function(){var a=r.find(".layui-layim-remark");a.on("change",function(){var a=this.value;layui.each(j.sign,function(b,c){c&&c(a)})}),a.on("keyup",function(a){var b=a.keyCode;13===b&&this.blur()})}//大分组切换
,tab:function(a){var b,c=r.find(".layui-layim-tab>li");"number"==typeof a?(b=a,a=c.eq(b)):b=a.index(),2<b?c.removeClass(g):(ba.tab.index=b,a.addClass(g).siblings().removeClass(g)),r.find(".layim-tab-content").eq(b).addClass(f).siblings(".layim-tab-content").removeClass(f)}//展开联系人分组
,spread:function(a){var b=a.attr("lay-type"),c="true"===b?"false":"true",d=layui.data("layim")[x.mine.id]||{};a.next()["true"===b?"removeClass":"addClass"](f),d["spread"+a.parent().index()]=c,layui.data("layim",{key:x.mine.id,value:d}),a.attr("lay-type",c),a.find(".layui-icon").html("true"===c?"&#xe61a;":"&#xe602;")}//搜索
,search:function(){var a=r.find(".layui-layim-search"),b=r.find("#layui-layim-search"),c=a.find("input"),d=function(){var a=c.val().replace(/\s/);if(""===a)ba.tab(0|ba.tab.index);else{for(var d=[],e=x.friend||[],f=x.group||[],g="",h=0;h<e.length;h++)for(var m=0;m<(e[h].list||[]).length;m++)-1!==e[h].list[m].username.indexOf(a)&&(e[h].list[m].type="friend",e[h].list[m].index=h,e[h].list[m].list=m,d.push(e[h].list[m]));for(var n=0;n<f.length;n++)-1!==f[n].groupname.indexOf(a)&&(f[n].type="group",f[n].index=n,f[n].list=n,d.push(f[n]));if(0<d.length)for(var o=0;o<d.length;o++)g+="<li layim-event=\"chat\" data-type=\""+d[o].type+"\" data-index=\""+d[o].index+"\" data-list=\""+d[o].list+"\"><img src=\""+d[o].avatar+"\"><span>"+(d[o].username||d[o].groupname||"\u4F5A\u540D")+"</span><p>"+(d[o].remark||d[o].sign||"")+"</p></li>";else g="<li class=\"layim-null\">\u65E0\u641C\u7D22\u7ED3\u679C</li>";b.html(g),ba.tab(3)}};!x.base.isfriend&&x.base.isgroup?ba.tab.index=1:!x.base.isfriend&&!x.base.isgroup&&(ba.tab.index=2),a.show(),c.focus(),c.off("keyup",d).on("keyup",d)}//关闭搜索
,closeSearch:function(a){a.parent().hide(),ba.tab(0|ba.tab.index)}//消息盒子
,msgbox:function(){var a=r.find(".layim-tool-msgbox");return c.close(ba.msgbox.index),a.find("span").removeClass(R).html(""),ba.msgbox.index=c.open({type:2,title:"\u6D88\u606F\u76D2\u5B50",shade:!1,maxmin:!0,area:["600px","520px"],skin:"layui-box layui-layer-border",resize:!1,content:x.base.msgbox})}//弹出查找页面
,find:function(){return c.close(ba.find.index),ba.find.index=c.open({type:2,title:"\u67E5\u627E",shade:!1,maxmin:!0,area:["1000px","520px"],skin:"layui-box layui-layer-border",resize:!1,content:x.base.find})}//弹出更换背景
,skin:function(){c.open({type:1,title:"\u66F4\u6362\u80CC\u666F",shade:!1,area:"300px",skin:"layui-box layui-layer-border",id:"layui-layim-skin",zIndex:66666666,resize:!1,content:d("<ul class=\"layui-layim-skin\">{{# layui.each(d.skin, function(index, item){ }}<li><img layim-event=\"setSkin\" src=\"{{ item }}\"></li>{{# }); }}<li layim-event=\"setSkin\"><cite>\u7B80\u7EA6</cite></li></ul>").render({skin:x.base.skin})})}//关于
,about:function(){c.alert("\u7248\u672C\uFF1A 3.8.0<br>\u7248\u6743\u6240\u6709\uFF1A<a href=\"http://layim.layui.com\" target=\"_blank\">layim.layui.com</a>",{title:"\u5173\u4E8E LayIM",shade:!1})}//生成换肤
,setSkin:function(a){var b=a.attr("src"),c=layui.data("layim")[x.mine.id]||{};c.skin=b,b||delete c.skin,layui.data("layim",{key:x.mine.id,value:c});try{r.css({"background-image":b?"url("+b+")":"none"}),t.css({"background-image":b?"url("+b+")":"none"})}catch(a){}layui.each(j.setSkin,function(a,c){var d=(b||"").replace(layui.cache.dir+"css/modules/layim/skin/","");c&&c(d,b)})}//弹出聊天面板
,chat:function(a){var b=layui.data("layim")[x.mine.id]||{},c=a.data("type"),d=a.data("index"),e=a.attr("data-list")||a.index(),f={};"friend"===c?f=x[c][d].list[e]:"group"===c?f=x[c][e]:"history"===c&&(f=(b.history||{})[d]||{}),f.name=f.name||f.username||f.groupname,"history"!==c&&(f.type=c),C(f)}//切换聊天
,tabChat:function(a){H(a)}//关闭聊天列表
,closeChat:function(a,b){H(a.parent(),1),$(b)},closeThisChat:function(){H(null,1)}//展开群组成员
,groupMembers:function(a){var d=a.find(".layui-icon"),e=function(){d.html("&#xe61a;"),a.data("down",null),c.close(ba.groupMembers.index)},f=function(a){$(a)};a.data("down")?e():(d.html("&#xe619;"),a.data("down",!0),ba.groupMembers.index=c.tips("<ul class=\"layim-members-list\"></ul>",a,{tips:3,time:0,anim:5,fixed:!0,skin:"layui-box layui-layim-members",success:function(c){var d=x.base.members||{},f=J(),g=c.find(".layim-members-list"),h="",i={},k=t.find(".layui-layer-max").hasClass("layui-layer-maxmin"),l="none"===t.find(".layim-chat-list").css("display");k&&g.css({width:b(window).width()-22-(l||200)}),d.data=b.extend(d.data,{id:f.data.id}),w(d,function(c){//获取群员
//私聊
layui.each(c.list,function(a,b){h+="<li data-uid=\""+b.id+"\"><a href=\"javascript:;\"><img src=\""+b.avatar+"\"><cite>"+b.username+"</cite></a></li>",i[b.id]=b}),g.html(h),a.find(".layim-chat-members").html(c.members||(c.list||[]).length+"\u4EBA"),g.find("li").on("click",function(){var a=b(this).data("uid"),c=i[a];C({name:c.username,type:"friend",avatar:c.avatar,id:c.id}),e()}),layui.each(j.members,function(a,b){b&&b(c)})}),c.on("mousedown",function(a){$(a)})}}),b(document).off("mousedown",e).on("mousedown",e),b(window).off("resize",e).on("resize",e),a.off("mousedown",f).on("mousedown",f))}//发送聊天内容
,send:function(){M()}//设置发送聊天快捷键
,setSend:function(a,c){var d=ba.setSend.box=a.siblings(".layim-menu-box"),e=a.attr("lay-type");if("show"===e)$(c),d.show().addClass(aa),b(document).off("click",ba.setSendHide).on("click",ba.setSendHide);else{a.addClass(g).siblings().removeClass(g);var f=layui.data("layim")[x.mine.id]||{};f.sendHotKey=e,layui.data("layim",{key:x.mine.id,value:f}),ba.setSendHide(c,a.parent())}},setSendHide:function(a,b){(b||ba.setSend.box).hide().removeClass(aa)}//表情
,face:function(a,d){var e="",f=J();for(var g in Z)e+="<li title=\""+g+"\"><img src=\""+Z[g]+"\"></li>";e="<ul class=\"layui-clear layim-face-list\">"+e+"</ul>",ba.face.index=c.tips(e,a,{tips:1,time:0,fixed:!0,skin:"layui-box layui-layim-face",success:function(a){a.find(".layim-face-list>li").on("mousedown",function(a){$(a)}).on("click",function(){_(f.textarea[0],"face"+this.title+" "),c.close(ba.face.index)})}}),b(document).off("mousedown",ba.faceHide).on("mousedown",ba.faceHide),b(window).off("resize",ba.faceHide).on("resize",ba.faceHide),$(d)},faceHide:function(){c.close(ba.face.index)}//图片或一般文件
,image:function(a){var b=a.data("type")||"images",d=J(),e=x.base[{images:"uploadImage",file:"uploadFile"}[b]]||{};layui.upload.render({url:e.url||"",method:e.type,elem:a.find("input")[0],accept:b,done:function(a){0==a.code?(a.data=a.data||{},"images"===b?_(d.textarea[0],"img["+(a.data.src||"")+"]"):"file"===b&&_(d.textarea[0],"file("+(a.data.src||"")+")["+(a.data.name||"\u4E0B\u8F7D\u6587\u4EF6")+"]"),M()):c.msg(a.msg||"\u4E0A\u4F20\u5931\u8D25")}})}//音频和视频
,media:function(a){var d=a.data("type"),e=J();c.prompt({title:"\u8BF7\u8F93\u5165\u7F51\u7EDC"+{audio:"\u97F3\u9891",video:"\u89C6\u9891"}[d]+"\u5730\u5740",shade:!1,offset:[a.offset().top-b(window).scrollTop()-158+"px",a.offset().left+"px"]},function(a,b){_(e.textarea[0],d+"["+a+"]"),M(),c.close(b)})}//扩展工具栏
,extend:function(a){var b=a.attr("lay-filter"),c=J();layui.each(j["tool("+b+")"],function(b,d){d&&d.call(a,function(a){_(c.textarea[0],a)},M,c)})}//播放音频
,playAudio:function(a){var b=a.data("audio"),d=b||document.createElement("audio"),e=function(){d.pause(),a.removeAttr("status"),a.find("i").html("&#xe652;")};return a.data("error")?c.msg("\u64AD\u653E\u97F3\u9891\u6E90\u5F02\u5E38"):d.play?void(a.attr("status")?e():(b||(d.src=a.data("src")),d.play(),a.attr("status","pause"),a.data("audio",d),a.find("i").html("&#xe651;"),d.onended=function(){e()},d.onerror=function(){c.msg("\u64AD\u653E\u97F3\u9891\u6E90\u5F02\u5E38"),a.data("error",!0),e()})):c.msg("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301audio")}//播放视频
,playVideo:function(a){var b=a.data("src"),d=document.createElement("video");return d.play?void(c.close(ba.playVideo.index),ba.playVideo.index=c.open({type:1,title:"\u64AD\u653E\u89C6\u9891",area:["460px","300px"],maxmin:!0,shade:!1,content:"<div style=\"background-color: #000; height: 100%;\"><video style=\"position: absolute; width: 100%; height: 100%;\" src=\""+b+"\" loop=\"loop\" autoplay=\"autoplay\"></video></div>"})):c.msg("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301video")}//聊天记录
,chatLog:function(){var a=J();return x.base.chatLog?(c.close(ba.chatLog.index),ba.chatLog.index=c.open({type:2,maxmin:!0,title:"\u4E0E "+a.data.name+" \u7684\u804A\u5929\u8BB0\u5F55",area:["450px","100%"],shade:!1,offset:"rb",skin:"layui-box",anim:2,id:"layui-layim-chatlog",content:x.base.chatLog+"?id="+a.data.id+"&type="+a.data.type})):c.msg("\u672A\u5F00\u542F\u66F4\u591A\u804A\u5929\u8BB0\u5F55")}//历史会话右键菜单操作
,menuHistory:function(a){var d=layui.data("layim")[x.mine.id]||{},e=a.parent(),f=a.data("type"),g=r.find(".layim-list-history"),h="<li class=\"layim-null\">\u6682\u65E0\u5386\u53F2\u4F1A\u8BDD</li>";if("one"===f){var i=d.history;delete i[e.data("index")],d.history=i,layui.data("layim",{key:x.mine.id,value:d}),b("#"+e.data("id")).remove(),0===g.find("li").length&&g.html(h)}else"all"===f&&(delete d.history,layui.data("layim",{key:x.mine.id,value:d}),g.html(h));c.closeAll("tips")}};//处理初始化信息
//暴露接口
a("layim",new k)}).addcss("modules/layim/layim.css?v=3.8.0","skinlayimcss");