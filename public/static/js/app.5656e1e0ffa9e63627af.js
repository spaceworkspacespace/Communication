webpackJsonp([1],{"/wR7":function(t,e){},"4Ud+":function(t,e){},"9WtT":function(t,e){t.exports=layer},FaZw:function(t,e){},Fnxs:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),r=n("gRE1"),s=n.n(r),i={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"x-mask-container"},[this._t("default")],2)},staticRenderFns:[]};var c=n("VU/8")({},i,!1,function(t){n("Q44U")},null,null).exports,o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"rounded bg-white border shadow x-list-select"},[n("p",{staticClass:"border bg-light font-weight-bold text-center py-2 my-0"},[t._v(t._s(t.title))]),t._v(" "),n("ul",{staticClass:"list-group",staticStyle:{"max-height":"384px","overflow-y":"auto"}},t._l(t.list,function(e,a){return n("li",{key:a,staticClass:"list-group-item x-friend-group-select-item",on:{click:function(e){return t.onSelect(a)}}},[t._v(t._s(e))])}),0)])},staticRenderFns:[]};var u=n("VU/8")({props:["list","title","auto-close"],methods:{onSelect:function(t){this.$emit("select",t),this.autoClose&&this.$store.commit("layer/hide",{type:"listSelect"})}}},o,!1,function(t){n("/wR7")},null,null).exports,l=n("//Fk"),d=n.n(l),f=n("Xxa5"),p=n.n(f),m=n("exGp"),v=n.n(m),h=n("BO1k"),g=n.n(h),x=n("woOf"),_=n.n(x),b=n("9WtT"),y=n.n(b),w=n("Zrlr"),k=n.n(w),C=n("wxAW"),E=n.n(C),S=n("mtWM"),G=n.n(S),F={userInfo:"/im/user/info",bind:"/im/user/bind"},T={avatar:"/im/comm/avatar",picture:"/im/comm/picture",file:"/im/comm/file"},M={mygroup:"/im/contact/mygroup",friend:"/im/contact/friend",friendAndGroup:"/im/contact/friendandgroup",friendGroup:"/im/contact/friendgroup",group:"/im/contact/group",groupMember:"/im/contact/groupmember"},A=function(){function t(){k()(this,t)}return E()(t,[{key:"uploadAvatar",value:function(t){return this.upload(T.avatar,t)}},{key:"upload",value:function(t,e){var n=new FormData;return n.append("file",e),G()({method:"POST",url:t,data:n}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t)}}]),t}();A._instance=null;var R=function(){function t(){k()(this,t)}return E()(t,[{key:"determineFriendGroupId",value:function(){var t=v()(p.a.mark(function t(e,n){var a,r,s,i,c,o,u,l,d;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G()({method:"GET",url:M.friendGroup}).then(function(t){if(t.data.code)throw new Error(t.data.msg||"请求失败, 请稍后重试~");return t.data.data});case 2:a=t.sent,r=null,s=!0,i=!1,c=void 0,t.prev=7,o=g()(a);case 9:if(s=(u=o.next()).done){t.next=17;break}if((l=u.value).group_name!==n){t.next=14;break}return r=l.id,t.abrupt("break",17);case 14:s=!0,t.next=9;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(7),i=!0,c=t.t0;case 23:t.prev=23,t.prev=24,!s&&o.return&&o.return();case 26:if(t.prev=26,!i){t.next=29;break}throw c;case 29:return t.finish(26);case 30:return t.finish(23);case 31:return r||(d=this.createFriendGroup(e,n),r=d.id),t.abrupt("return",r);case 33:case"end":return t.stop()}},t,this,[[7,19,23,31],[24,,26,30]])}));return function(e,n){return t.apply(this,arguments)}}()},{key:"getFriendAndGroup",value:function(){var t=v()(p.a.mark(function t(){var e;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G()({method:"GET",url:M.friendGroup,params:{include:!0}});case 2:if(!(e=(e=t.sent).data).code&&e.data){t.next=6;break}throw new Error(e.msg||"请求失败, 请稍后重试~");case 6:return t.abrupt("return",e.data);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getFriendGroup",value:function(t,e){return G()({method:"GET",url:M.friendGroup,params:{include:e}}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");var n=e.data,a=e.msg;return n.forEach(function(t){return t.createtime*=1e3}),n||a})}},{key:"getFriend",value:function(t,e){return G()({method:"GET",params:e,url:M.friend}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"addFriend",value:function(t,e,n,a){return G()({method:"POST",data:{id:e,fgId:n,content:a},url:M.friend}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"updateFriend",value:function(t,e){return G()({method:"PUT",data:e,url:M.friend}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"deleteFriend",value:function(t,e){return G()({method:"DELETE",params:{id:e},url:M.friend}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"createFriendGroup",value:function(t,e){return G()({method:"POST",url:M.friendGroup,params:{groupname:e}}).then(function(t){if(t.data.code)throw new Error(t.data.msg||"请求失败, 请稍后重试~");return t.data.data})}},{key:"updateFriendGroup",value:function(t,e){return G()({method:"PUT",params:e,url:M.friendGroup}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"deleteFriendGroup",value:function(t,e){return G()({method:"DELETE",params:e,url:M.friendGroup}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"joinGroup",value:function(t,e,n){return G()({method:"POST",data:{gid:e,content:n},url:M.mygroup}).then(function(t){var e=t.data,n=e.data||e.msg;if(e.code)throw new Error(n||"请求失败, 请稍后重试~");return n})}},{key:"createGroup",value:function(t,e){return G()({method:"POST",data:e,url:M.group}).then(function(t){var e=t.data,n=e.data||e.msg;if(e.code)throw new Error(n||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"getGroup",value:function(t,e){return G()({method:"GET",params:{_ajax:!0},url:M.group}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"pudateGroup",value:function(t,e){return G()({method:"PUT",data:e,url:M.group}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"deleteGroup",value:function(t,e){return G()({method:"DELETE",params:{gid:e.id},url:M.group}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"getGroupMember",value:function(t,e){return G()({method:"GET",url:M.groupMember,params:{id:e}}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data.list||e.msg})}},{key:"deleteGroupMember",value:function(t,e,n){return G()({method:"DELETE",url:M.groupMember,params:{gid:e.id,uid:n?n.id:t}}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}},{key:"updateGroupMember",value:function(t,e){return G()({method:"PUT",url:M.groupMember,params:e}).then(function(t){var e=t.data;if(e.code)throw new Error(e.msg||"请求失败, 请稍后重试~");return e.data||e.msg})}}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t)}}]),t}();R._instance=null;var I={props:["group"],data:function(){return{g:{},edited:!1}},beforeMount:function(){_()(this.g,this.group)},computed:{adminName:function(){var t=!0,e=!1,n=void 0;try{for(var a,r=g()(this.g.list);!(t=(a=r.next()).done);t=!0){var s=a.value;if(s.id===this.g.admin)return s.username}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}return this.g.admin},adminList:function(){return this.g.list.filter(function(t){return t.isadmin})},isAdmin:function(){return this.g.id===this.$store.state.user.id}},methods:{format:function(t){return function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd  HH:mm:ss",n=/([a-zA-Z])\1+/g,a=e,r=n.exec(e);null!==r;r=n.exec(e)){var s=null,i=r[0].length;switch(r[1]){case"y":s=t.getFullYear();break;case"M":s=t.getMonth()+1;break;case"d":s=t.getDate();break;case"H":s=t.getHours();break;case"m":s=t.getMinutes();break;case"s":s=t.getSeconds();break;default:continue}(s=s.toString()).length>i&&(s=s.substring(0,i)),s.length<i&&(s=s.padStart(i,"0")),a=a.replace(r[0],s)}return a}(t,"yyyy-MM-dd")},selectPicture:function(){this.$refs.avatar.click()},submitPicture:function(){var t=v()(p.a.mark(function t(){var e,n;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.$refs.avatar.value){t.next=2;break}return t.abrupt("return");case 2:if(e=this.$refs.avatar.files[0]){t.next=6;break}return y.a.msg("无效文件"),t.abrupt("return");case 6:return t.prev=6,t.next=9,A.getInstance().uploadAvatar(e);case 9:n=t.sent,this.g=_()({},this.g,{avatar:n.src}),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(6),console.error(t.t0),y.a.msg(t.t0.message||"操作失败, 请稍后重试~");case 17:this.$refs.avatar.value="";case 18:case"end":return t.stop()}},t,this,[[6,13]])}));return function(){return t.apply(this,arguments)}}(),transfer:function(){var t=v()(p.a.mark(function t(){var e,n=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a(function(t,e){y.a.confirm("转移之后, 您将会变更为成员, 是否确认?",{title:"群聊转移"},function(e){y.a.close(e),t(!0)},function(){return t(!1)})});case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,new d.a(function(t,e){n.$store.commit("layer/show",{title:"选择转移成员",type:"listSelect",list:n.g.list.map(function(t){return t.username+" ("+t.id+")"}),onselect:function(e){t(n.g.list[e])}})});case 7:e=t.sent,this.g.admin=e.id,this.g=_()({},this.g,{admin:e.id});case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),close:function(){this.$store.commit("layer/hide",{type:"groupEdit"}),this.edited&&this.$emit("submit",this.g)},submit:function(){var t=v()(p.a.mark(function t(){var e,n,a;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a(function(t,e){y.a.confirm("提交后将不可回退 !",function(e){y.a.close(e),t(!0)},function(){return t(!1)})});case 2:if(t.sent){t.next=6;break}return y.a.msg("取消提交"),t.abrupt("return");case 6:return e=this.$store.state.user,n="修改成功",t.prev=8,t.next=11,R.getInstance().pudateGroup(e.id,{gid:this.g.id,name:this.g.groupname,desc:this.g.description,avatar:this.g.avatar,admin:this.g.admin});case 11:a=t.sent,this.g=_()({},this.g,a),this.edited=!0,t.next=20;break;case 16:t.prev=16,t.t0=t.catch(8),console.error(t.t0),n=t.t0.message;case 20:y.a.msg(n);case 21:case"end":return t.stop()}},t,this,[[8,16]])}));return function(){return t.apply(this,arguments)}}()}},P={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"x-group-edit container"},[n("p",{staticClass:"bg-light border h3 mx-0 px-2 my-2 ",staticStyle:{"line-height":"55px",position:"relative",left:"0",right:"0"}},[t._v("\n        群组编辑\n    ")]),t._v(" "),n("form",{staticClass:"px-3"},[n("div",{staticClass:"row my-3"},[t._m(0),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("img",{staticStyle:{width:"96px",height:"96px",cursor:"pointer"},attrs:{src:t.g.avatar},on:{click:t.selectPicture}}),t._v(" "),n("input",{ref:"avatar",staticStyle:{display:"none"},attrs:{accept:"image/png, image/jpeg",type:"file"},on:{change:t.submitPicture}})])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[t._v("群名称")]),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.g.groupname,expression:"g.groupname"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.g.groupname},on:{input:function(e){e.target.composing||t.$set(t.g,"groupname",e.target.value)}}})])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[t._v("创建时间")]),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("p",[t._v(t._s(t.format(new Date(1e3*t.g.createtime))))])])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[t._v("群主")]),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("p",[t._v("\n                    "+t._s(t.adminName)+"\n                    "),t.isAdmin?n("a",{staticClass:"text-danger pl-2",attrs:{href:"javascript:;"},on:{click:function(e){return e.preventDefault(),t.transfer(e)}}},[t._v("转让")]):t._e()])])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[t._v("成员数量")]),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("p",[t._v(t._s(t.g.membercount))])])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[t._v("管理员列表")]),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("ul",{staticClass:"list-group",staticStyle:{"max-height":"384px","overflow-y":"auto"}},t._l(t.adminList,function(e){return n("li",{key:e.id,staticClass:"list-group-item"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-3 col-md-2"},[n("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:e.avatar}})]),t._v(" "),n("div",{staticClass:"col-9 col-md-10"},[n("p",[t._v(t._s(e.username))])])])])}),0)])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[t._v("描述")]),t._v(" "),n("div",{staticClass:"col-sm-8 col-md-9 offset-sm-0 offset-1"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.g.description,expression:"g.description"}],staticClass:"form-control",staticStyle:{"min-height":"194px"},attrs:{row:"","my-3":"5"},domProps:{value:t.g.description},on:{input:function(e){e.target.composing||t.$set(t.g,"description",e.target.value)}}})])]),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"row my-3"},[n("div",{staticClass:"offset-sm-2 col-sm-4"},[n("button",{staticClass:"btn btn-primary btn-block",attrs:{type:"button"},on:{click:t.submit}},[t._v("保存")])]),t._v(" "),n("div",{staticClass:"col-sm-4 my-3 my-sm-0"},[n("button",{staticClass:"btn btn-secondary btn-block",attrs:{type:"button"},on:{click:t.close}},[t._v("关闭")])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-sm-4 col-md-3 x-colon font-weight-bold"},[this._v("\n                图片\n                "),e("small",[this._v("(点击图像进行切换)")])])}]};var D=n("VU/8")(I,P,!1,function(t){n("OenY")},null,null).exports,U={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"x-droplist"},[n("button",{staticClass:"btn btn-block btn-default border",on:{click:function(e){return e.stopPropagation(),t.toggle(e)}}},[t._v(t._s(t.text))]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"position-relative"},[n("ul",{staticClass:"list-group x-list"},t._l(t.list,function(e,a){return n("li",{key:a,staticClass:"list-group-item",on:{click:function(e){return e.stopPropagation(),t.select(a)}}},[t._v(t._s(e))])}),0)])])},staticRenderFns:[]};var O={props:["list","title","hint","autoClose"],components:{DropList:n("VU/8")({name:"DropList",props:["list","defaultText"],data:function(){return{text:"",show:!1}},beforeMount:function(){this.text=this.defaultText||"请选择"},methods:{select:function(t){this.$emit("xchange",t),this.text=this.list[t],this.show=!this.show},toggle:function(){this.show=!this.show}}},U,!1,function(t){n("XpGk")},"data-v-14bfa818",null).exports},data:function(){return{option:"",content:""}},methods:{cancel:function(t){this.$store.commit("layer/hide",{type:"contactAdd"}),this.$emit("cancel")},submit:function(t){this.list&&!this.option||!this.content?layer.msg("信息不能为空!"):(this.$emit("submit",{option:this.option,content:this.content}),this.autoClose&&this.$store.commit("layer/hide",{type:"contactAdd"}))}}},N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container x-absolute-center rounded shadow border",attrs:{id:"x-layer-contact-add"}},[n("p",{staticClass:"bg-light border h3 mx-0 px-2 my-2 ",staticStyle:{"line-height":"55px",position:"relative",left:"0",right:"0"}},[t._v("\n        "+t._s(t.title)+"\n    ")]),t._v(" "),n("form",[t.list?n("div",{staticClass:"form-group"},[n("label",[t._v("选择好友的分组")]),t._v(" "),n("select",{directives:[{name:"model",rawName:"v-model",value:t.option,expression:"option"}],staticClass:"form-control",on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.option=e.target.multiple?n:n[0]}}},[n("option",{attrs:{disabled:"",value:""}},[t._v("请选择")]),t._v(" "),t._l(t.list,function(e){return n("option",{key:e.value,domProps:{value:e.value}},[t._v(t._s(e.text))])})],2),t._v(" "),n("small",[t._v("在好友添加成功后, 将会到你选择的分组下.")])]):t._e(),t._v(" "),n("div",{staticClass:"form-group"},[n("label",[t._v("验证信息")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"form-control",domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"form-row"},[n("button",{staticClass:"offset-1 col-4 btn btn-block btn-primary",attrs:{type:"button"},on:{click:t.submit}},[t._v("发送")]),t._v(" "),n("button",{staticClass:"offset-2 col-4 btn btn-block btn-secondary mt-0",attrs:{type:"button"},on:{click:t.cancel}},[t._v("取消")])])])])},staticRenderFns:[]};var j={components:{ListSelect:u,MaskContainer:c,GroupEdit:D,ContactAdd:n("VU/8")(O,N,!1,function(t){n("4Ud+")},null,null).exports},beforeMount:function(){},watch:{show:function(t,e){$(document.body).css({"overflow-y":t?"hidden":"auto"})}},computed:{layers:function(){return this.$store.state.layer},show:function(){return s()(this.layers).some(function(t){return t.show})}}},L={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.show?n("mask-container",{staticStyle:{"z-index":"100"}},[t.layers.groupEdit.show?n("mask-container",{staticStyle:{"background-color":"transparent","z-index":"100"}},[n("group-edit",{style:t.layers.groupEdit.style,attrs:{"auto-close":t.layers.groupEdit.autoClose,group:t.layers.groupEdit.group},on:{submit:t.layers.groupEdit.onsubmit}})],1):t._e(),t._v(" "),t.layers.contactAdd.show?n("mask-container",{staticStyle:{"background-color":"transparent","z-index":"110"}},[n("contact-add",{style:t.layers.contactAdd.style,attrs:{title:t.layers.contactAdd.title,list:t.layers.contactAdd.list,"auto-close":t.layers.contactAdd.autoClose},on:{submit:t.layers.contactAdd.onsubmit,cancel:t.layers.contactAdd.oncancel}})],1):t._e(),t._v(" "),t.layers.listSelect.show?n("mask-container",{staticStyle:{"background-color":"transparent","z-index":"120"}},[n("list-select",{style:t.layers.listSelect.style,attrs:{title:t.layers.listSelect.title,list:t.layers.listSelect.list,"auto-close":t.layers.listSelect.autoClose},on:{select:t.layers.listSelect.onselect}})],1):t._e()],1):t._e()},staticRenderFns:[]};var V={name:"App",components:{Layer:n("VU/8")(j,L,!1,function(t){n("Zdx/")},null,null).exports}},Y={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view"),this._v(" "),e("layer")],1)},staticRenderFns:[]};var z=n("VU/8")(V,Y,!1,function(t){n("QdD9")},null,null).exports,H=n("/ocq"),W=n("NYxO"),Z={getUser:function(t){var e=t.commit;G()({method:"GET",url:"/im/user/info"}).then(function(t){t.data.code?(y.a.msg(t.data.msg||"获取用户信息失败."),e("setUser",null)):e("setUser",t.data.data)})}},Q=n("Dd8w"),X=n.n(Q),K={type:"",show:!1,style:{},autoClose:!0},q={listSelect:X()({},K,{title:"选项列表",list:["选项1","选项2","..."],onselect:function(t){}}),groupEdit:X()({},K,{group:{},onsubmit:function(t){}}),contactAdd:X()({},K,{title:"添加联系人",hint:"请填写验证信息",list:[{text:"选项1",value:"one"},{text:"选项2",value:"two"},"..."],onsubmit:function(t){t.option,t.content},oncancel:function(){}})},B={namespaced:!0,state:X()({},q),actions:{show:function(){},hide:function(){}},mutations:{show:function(t,e){t[e.type]=_()({},q[e.type],e,{show:!0})},hide:function(t,e){if(e)t[e.type]={show:!1};else for(var n in t)t[n].show&&(t[n].show=!1)}}};a.a.use(W.a);var J=new W.a.Store({actions:Z,mutations:{setUser:function(t,e){t.user=e}},state:{user:null},modules:{layer:B}}),tt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container-fluid",attrs:{id:"x-contactmgr"}},[n("nav",{staticClass:"navbar navbar-expand-lg navbar-light bg-light shadow-sm",staticStyle:{"z-index":"10",margin:"0 -15px"}},[n("router-link",{staticClass:"navbar-brand",attrs:{to:t.$router.currentRoute.matched[0].path}},[t._v("联系人管理")]),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"collapse navbar-collapse",attrs:{id:"contact-type"}},[n("ul",{staticClass:"navbar-nav mr-auto"},[n("li",{staticClass:"nav-item"},[n("router-link",{staticClass:"nav-link",attrs:{to:t.$router.currentRoute.matched[0].path+"/find"}},[t._v("搜索")])],1),t._v(" "),n("li",{staticClass:"nav-item"},[n("router-link",{staticClass:"nav-link",attrs:{to:t.$router.currentRoute.matched[0].path+"/friend"}},[t._v("好友")])],1),t._v(" "),n("li",{staticClass:"nav-item"},[n("router-link",{staticClass:"nav-link",attrs:{to:t.$router.currentRoute.matched[0].path+"/group"}},[t._v("群聊")])],1),t._v(" "),n("li",{staticClass:"nav-item"},[n("router-link",{staticClass:"nav-link",attrs:{to:t.$router.currentRoute.matched[0].path+"/groupnew"}},[t._v("新建群聊")])],1)])])],1),t._v(" "),n("div",{staticClass:"x-fill x-flex",staticStyle:{top:"56px","z-index":"9"}},[t.keyword?n("div"):n("router-view")],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"navbar-toggler",attrs:{type:"button","data-toggle":"collapse","data-target":"#contact-type"}},[e("span",{staticClass:"navbar-toggler-icon"})])}]};var et=n("VU/8")({data:function(){return{friend:[],currentGroup:0,keyword:""}},beforeMount:function(){}},tt,!1,function(t){n("daK1")},null,null).exports,nt=n("bOdI"),at=n.n(nt),rt={data:function(){var t;return t={init:null,peerConnM:null,peerConnY:null,localStream:null},at()(t,"peerConnM",null),at()(t,"peerConnY",null),t},mounted:function(){var t=v()(p.a.mark(function t(){var e,n,a,r=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0,facingMode:"user"});case 2:e=t.sent,this.$refs.videom.srcObject=this.localStream=e,(n=this.peerConnM=new RTCPeerConnection).addStream(e),n.onicecandidate=function(t){event.candidate&&r.peerConnY.addIceCandidate(event.candidate)},(a=this.peerConnY=new RTCPeerConnection).onaddstream=function(t){r.$refs.videoy.srcObject=t.stream},a.onicecandidate=function(t){t.candidate&&r.peerConnM.addIceCandidate(t.candidate)},this.connect();case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:{connect:function(){var t=v()(p.a.mark(function t(){var e,n;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.peerConnM.createOffer();case 2:return e=t.sent,t.next=5,this.peerConnY.setRemoteDescription(e);case 5:return t.next=7,this.peerConnM.setLocalDescription(e);case 7:return t.next=9,this.peerConnY.createAnswer();case 9:return n=t.sent,t.next=12,this.peerConnY.setLocalDescription(n);case 12:return t.next=14,this.peerConnM.setRemoteDescription(n);case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},st={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"x-webvideocall"}},[e("video",{ref:"videom",staticClass:"x-webvideocall-video",attrs:{autoplay:"true"}},[this._v("您的浏览器不支持视屏通话.")]),this._v(" "),e("video",{ref:"videoy",staticClass:"x-webvideocall-video",attrs:{autoplay:"true"}},[this._v("您的浏览器不支持视屏通话.")])])},staticRenderFns:[]};var it=n("VU/8")(rt,st,!1,function(t){n("Fnxs")},null,null).exports,ct={data:function(){return{index:0,contacts:[],error:!1,errorText:""}},computed:{groupNames:function(){return this.contacts.map(function(t){return t.groupname})}},components:{},beforeMount:function(){this.pull()},methods:{pull:function(){var t=this;return R.getInstance().getFriendAndGroup().then(function(e){return t.contacts=e}).catch(function(e){t.error=!0,t.errorText=e.message||"请求错误, 请稍后重试.",y.a.msg(t.errorText)})},deleteFriend:function(){var t=v()(p.a.mark(function t(e,n){var a,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a="请求错误, 请稍后重试.",r=this.$store.state.user,t.prev=2,t.next=5,new d.a(function(t,n){y.a.confirm("确认删除'"+e+"'?",{title:"删除联系人"},function(e){y.a.close(e),t(!0)},function(){t(!1)})});case 5:if(t.sent){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,R.getInstance().deleteFriend(r.id,n);case 10:a=t.sent,this.pull(),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(2),console.error(t.t0),a=t.t0.message;case 18:y.a.msg(a);case 19:case"end":return t.stop()}},t,this,[[2,14]])}));return function(e,n){return t.apply(this,arguments)}}(),deleteFriendGroup:function(){var t=v()(p.a.mark(function t(e){var n,a,r,s,i,c,o,u=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n="请求错误, 请稍后重试.",a=this.$store.state.user,t.prev=2,r=this.contacts[e].id,t.next=6,R.getInstance().determineFriendGroupId(a.id,"我的好友");case 6:if(s=t.sent,r!==s){t.next=9;break}throw new Error("默认分组无法删除.");case 9:return t.next=11,this.pull();case 11:if(!this.contacts[e].list.length){t.next=16;break}return t.next=14,new d.a(function(t,e){u.$store.commit("layer/show",{type:"listSelect",title:"将分组中的联系人转移到",list:u.groupNames,style:{width:"340px"},onselect:function(e){return t(e)}})});case 14:i=t.sent,this.contacts[i]&&"number"==typeof this.contacts[i].id&&(c=this.contacts[i].id,s=c);case 16:return t.next=18,R.getInstance().deleteFriendGroup(a.id,{id:r,into:s});case 18:return n=t.sent,t.next=21,this.pull();case 21:o=this.contacts.length-1;case 22:if(!(o>=0)){t.next=30;break}if(this.contacts[o].id!==s){t.next=27;break}return this.index=o,t.abrupt("return");case 27:o--,t.next=22;break;case 30:t.next=36;break;case 32:t.prev=32,t.t0=t.catch(2),console.error(t.t0),n=t.t0.message;case 36:y.a.msg(n);case 37:case"end":return t.stop()}},t,this,[[2,32]])}));return function(e){return t.apply(this,arguments)}}(),moveFriend:function(){var t=v()(p.a.mark(function t(e,n){var a,r,s,i,c,o=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a="请求错误, 请稍后重试.",r=this.$store.state.user,t.prev=2,t.next=5,new d.a(function(t,e){o.$store.commit("layer/show",{type:"listSelect",title:"将好友移动到",list:o.groupNames,style:{width:"340px"},onselect:function(e){return t(e)}})});case 5:return s=t.sent,i=this.contacts[s].id,t.next=9,R.getInstance().updateFriend(r.id,{contact:n,group:i});case 9:return a=t.sent,t.next=12,this.pull();case 12:c=this.contacts.length-1;case 13:if(!(c>=0)){t.next=21;break}if(this.contacts[c].id!==i){t.next=18;break}return this.index=c,t.abrupt("return");case 18:c--,t.next=13;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(2),console.error(t.t0),a=t.t0.message;case 27:y.a.msg(a);case 28:case"end":return t.stop()}},t,this,[[2,23]])}));return function(e,n){return t.apply(this,arguments)}}(),renameFriend:function(){var t=v()(p.a.mark(function t(e,n){var a,r,s,i;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a="",t.prev=1,t.next=4,new d.a(function(t,e){return y.a.prompt({title:"好友别名",value:n.username},function(e,n){y.a.close(n),t(e.trim())})});case 4:if((r=t.sent)!==n.username){t.next=7;break}return t.abrupt("return");case 7:return s=this.$store.state.user,t.next=10,R.getInstance().updateFriend(s.id,{contact:n.id,alias:r});case 10:i=t.sent,n.username=i.alias,t.next=19;break;case 14:t.prev=14,t.t0=t.catch(1),a=t.t0.message,y.a.msg(a),console.error(t.t0);case 19:case"end":return t.stop()}},t,this,[[1,14]])}));return function(e,n){return t.apply(this,arguments)}}(),groupNameCheck:function(t){if(!t)return y.a.msg("无效的输入."),!1;var e=!0,n=!1,a=void 0;try{for(var r,s=g()(this.contacts);!(e=(r=s.next()).done);e=!0){if(r.value.groupname===t)return y.a.msg("分组已存在."),!1}}catch(t){n=!0,a=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw a}}return!0},switchIndex:function(t){this.index=t},renameGroup:function(){var t=v()(p.a.mark(function t(e){var n,a,r,s;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a(function(t,e){return y.a.prompt({title:"分组名称",value:"在此输入新的分组名称"},function(e,n){y.a.close(n),t(e.trim())})});case 2:if(n=t.sent,this.groupNameCheck(n)){t.next=5;break}return t.abrupt("return");case 5:return a=this.$store.state.user,r="",t.prev=7,t.next=10,R.getInstance().updateFriendGroup(a.id,{id:this.contacts[e].id,name:n});case 10:r=t.sent,(s=this.contacts[e]).groupname=n,this.contacts.splice(e,1,s),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(7),r=t.t0.message;case 19:y.a.msg(r);case 20:case"end":return t.stop()}},t,this,[[7,16]])}));return function(e){return t.apply(this,arguments)}}(),addGroup:function(){var t=v()(p.a.mark(function t(e){var n,a,r,s,i,c;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=34;break}return t.next=3,new d.a(function(t,e){return y.a.prompt({title:"分组名称",value:"在此输入新的分组名称"},function(e,n){y.a.close(n),t(e.trim())})});case 3:if(e=t.sent){t.next=7;break}return y.a.msg("无效的输入."),t.abrupt("return");case 7:n=!0,a=!1,r=void 0,t.prev=10,s=g()(this.contacts);case 12:if(n=(i=s.next()).done){t.next=20;break}if(i.value.groupname!==e){t.next=17;break}return y.a.msg("分组已存在."),t.abrupt("return");case 17:n=!0,t.next=12;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(10),a=!0,r=t.t0;case 26:t.prev=26,t.prev=27,!n&&s.return&&s.return();case 29:if(t.prev=29,!a){t.next=32;break}throw r;case 32:return t.finish(29);case 33:return t.finish(26);case 34:return c=this.$store.state.user,t.prev=35,t.next=38,R.getInstance().createFriendGroup(c.id,e);case 38:t.next=43;break;case 40:t.prev=40,t.t1=t.catch(35),y.a.msg(t.t1.message||"请求错误, 请稍后重试.");case 43:return t.prev=43,this.pull(),t.finish(43);case 46:case"end":return t.stop()}},t,this,[[10,22,26,34],[27,,29,33],[35,40,43,46]])}));return function(e){return t.apply(this,arguments)}}()}},ot={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"x-friendmgr"}},[t.error?n("div",[n("p",{staticStyle:{"text-align":"center","line-height":"128px","margin-top":"136px"}},[t._v(t._s(t.errorText))])]):t.contacts.length?n("div",{staticClass:"row px-0 mx-0",staticStyle:{height:"100%",width:"100%"}},[n("div",{staticClass:"col-md-5",staticStyle:{"min-height":"75vh"}},[t._m(1),t._v(" "),n("div",{staticClass:"py-2"},[n("span",{staticClass:"fa-stack",attrs:{title:"添加分组"},on:{click:function(e){return e.preventDefault(),t.addGroup()}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-plus fa-stack-1x"})])]),t._v(" "),n("ul",{staticClass:"nav flex-column nav-pills x-friendmgr-list",staticStyle:{top:"96px"}},t._l(t.contacts,function(e,a){return n("li",{key:e.id,staticClass:"nav-item",on:{click:function(e){return t.switchIndex(a)}}},[n("div",{class:["nav-link d-flex border flex-row justify-content-between align-items-center",a!==t.index?"":"active"],staticStyle:{cursor:"pointer"},attrs:{href:"javascript:;"}},[n("div",[t._v(t._s(e.groupname))]),t._v(" "),n("div",{staticStyle:{"min-width":"70px"}},[n("span",{staticClass:"fa-stack",attrs:{title:"重命名分组"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.renameGroup(a)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-pencil fa-stack-1x"})]),t._v(" "),n("span",{staticClass:"fa-stack",attrs:{title:"删除分组"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteFriendGroup(a)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-trash fa-stack-1x"})])])])])}),0)]),t._v(" "),n("div",{staticClass:"col-md-7",staticStyle:{"min-height":"75vh"}},[t._m(2),t._v(" "),n("ul",{staticClass:"list-group x-friendmgr-list"},t._l(t.contacts[t.index].list,function(e){return n("li",{key:e.id,staticClass:"list-group-item"},[n("div",{staticClass:"d-flex flex-row justify-content-between align-items-center"},[n("div",[t._v(t._s(e.username))]),t._v(" "),n("div",[n("span",{staticClass:"fa-stack",attrs:{title:"别名"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.renameFriend(t.index,e)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-pencil fa-stack-1x"})]),t._v(" "),n("span",{staticClass:"fa-stack",attrs:{title:"移动联系人"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.moveFriend(e.username,e.id)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-exchange fa-stack-1x"})]),t._v(" "),n("span",{staticClass:"fa-stack",attrs:{title:"删除联系人"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.deleteFriend(e.username,e.id)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-trash fa-stack-1x"})])])])])}),0)])]):n("div",[t._m(0)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticStyle:{"text-align":"center","line-height":"128px","margin-top":"136px"}},[e("span",{staticClass:"fa fa-spin fa-refresh mr-2"}),this._v("加载中...\n        ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"list-group"},[e("li",{staticClass:"list-group-item font-weight-bold text-center border-0"},[this._v("分组列表")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"list-group"},[e("li",{staticClass:"list-group-item font-weight-bold text-center border-0"},[this._v("好友列表")])])}]};var ut=n("VU/8")(ct,ot,!1,function(t){n("rLTo")},null,null).exports,lt={data:function(){return{index:0,contacts:null,error:!1,errorText:""}},beforeMount:function(){this.pull()},watch:{index:function(t,e){this.orderMembers(this.contacts[t]),this.calculStyle(this.contacts[t])}},methods:{pull:function(){var t=v()(p.a.mark(function t(){var e,n,a,r,s,i,c,o;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=this.$store.state.user,t.next=4,R.getInstance().getGroup(e.id,{include:!0});case 4:for(n=t.sent,this.contacts=n,this.orderMembers(this.contacts[this.index]),a=!0,r=!1,s=void 0,t.prev=10,i=g()(this.contacts);!(a=(c=i.next()).done);a=!0)o=c.value,this.calculStyle(o);t.next=18;break;case 14:t.prev=14,t.t0=t.catch(10),r=!0,s=t.t0;case 18:t.prev=18,t.prev=19,!a&&i.return&&i.return();case 21:if(t.prev=21,!r){t.next=24;break}throw s;case 24:return t.finish(21);case 25:return t.finish(18);case 26:t.next=34;break;case 28:t.prev=28,t.t1=t.catch(0),this.error=!0,this.errorText=t.t1.message||REQUEST_ERROR,y.a.msg(this.errorText),console.error(t.t1);case 34:case"end":return t.stop()}},t,this,[[0,28],[10,14,18,26],[19,,21,25]])}));return function(){return t.apply(this,arguments)}}(),switchIndex:function(t){this.index=t},editGroup:function(t){var e=this;this.$store.commit("layer/show",{type:"groupEdit",group:this.contacts[t],onsubmit:function(n){e.contacts.splice(t,1,X()({},n))}})},dismissGroup:function(){var t=v()(p.a.mark(function t(e){var n,a,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.contacts[e],a="",t.prev=2,t.next=5,new d.a(function(t,e){y.a.confirm("是否解散群聊“"+n.groupname+"”?",function(e){y.a.close(e),t(!0)},function(){return t(!1)})});case 5:if(t.sent){t.next=8;break}return t.abrupt("return");case 8:return r=this.$store.state.user,t.next=11,R.getInstance().deleteGroup(r.id,n);case 11:a=t.sent,y.a.alert(a),t.next=20;break;case 15:t.prev=15,t.t0=t.catch(2),console.error(t.t0),a=t.t0.message,y.a.msg(a);case 20:case"end":return t.stop()}},t,this,[[2,15]])}));return function(e){return t.apply(this,arguments)}}(),leaveGroup:function(){var t=v()(p.a.mark(function t(e){var n,a,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a(function(t,n){y.a.confirm("是否退出群聊“"+e.groupname+"”?",function(e){y.a.close(e),t(!0)},function(){return t(!1)})});case 2:if(t.sent){t.next=6;break}return y.a.msg("取消操作"),t.abrupt("return");case 6:return n="",t.prev=7,a=this.$store.state.user,t.next=11,R.getInstance().deleteGroupMember(a.id,e);case 11:n=t.sent,(r=this.contacts.indexOf(e))>0&&this.contacts.splice(r,1),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(7),n=t.t0.message,console.error(t.t0);case 20:y.a.msg(n);case 21:case"end":return t.stop()}},t,this,[[7,16]])}));return function(e){return t.apply(this,arguments)}}(),renameMember:function(){var t=v()(p.a.mark(function t(e,n){var a,r,s;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a(function(t,e){y.a.prompt({title:"输入成员的昵称",value:n.username},function(e,n){y.a.close(n),t(e.trim())})});case 2:if(a=t.sent,r="",t.prev=4,a&&a!==n.username){t.next=8;break}return y.a.msg("输入无效数据."),t.abrupt("return");case 8:return t.next=10,R.getInstance().updateGroupMember(this.$store.state.user.id,{gid:e,uid:n.id,alias:a});case 10:s=t.sent,_()(n,s),r="修改成功",t.next=19;break;case 15:t.prev=15,t.t0=t.catch(4),console.error(t.t0),r=t.t0.message;case 19:y.a.msg(r);case 20:case"end":return t.stop()}},t,this,[[4,15]])}));return function(e,n){return t.apply(this,arguments)}}(),privilegeMember:function(){var t=v()(p.a.mark(function t(e,n){var a,r,s;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.id,t.next=3,new d.a(function(t,e){y.a.confirm(n.username+"将被设为"+(n.isadmin?"成员":"管理员"),function(e){y.a.close(e),t(!0)},function(){t(!1)})});case 3:if(t.sent){t.next=7;break}return y.a.msg("取消操作"),t.abrupt("return");case 7:return r="",t.prev=8,t.next=11,R.getInstance().updateGroupMember(this.$store.state.user.id,{gid:a,uid:n.id,admin:!n.isadmin});case 11:s=t.sent,_()(n,s),this.calculStyle(e),this.orderMembers(e),r="修改成功",console.log(e),console.log(n),t.next=24;break;case 20:t.prev=20,t.t0=t.catch(8),console.error(t.t0),r=t.t0.message;case 24:y.a.msg(r);case 25:case"end":return t.stop()}},t,this,[[8,20]])}));return function(e,n){return t.apply(this,arguments)}}(),removeMember:function(){var t=v()(p.a.mark(function t(e,n){var a,r,s;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new d.a(function(t,a){y.a.confirm("是否将“"+n.username+"”退出群聊“"+e.groupname+"”?",function(e){y.a.close(e),t(!0)},function(){return t(!1)})});case 2:if(t.sent){t.next=6;break}return y.a.msg("取消操作"),t.abrupt("return");case 6:return a="",t.prev=7,r=this.$store.state.user,t.next=11,R.getInstance().deleteGroupMember(r.id,e,n);case 11:a=t.sent,(s=e.list.indexOf(n))>0&&e.list.splice(s,1),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(7),a=t.t0.message,console.error(t.t0);case 20:y.a.msg(a);case 21:case"end":return t.stop()}},t,this,[[7,16]])}));return function(e,n){return t.apply(this,arguments)}}(),calculStyle:function(t){var e=this.$store.state.user;t._calculStyle=!0,t._operate={edit:this.isAdmin(t)||e.id===t.admin,dismiss:e.id===t.admin};var n=!0,a=!1,r=void 0;try{for(var s,i=g()(t.list);!(n=(s=i.next()).done);n=!0){var c=s.value;c._operate={edit:t.admin!==c.id&&(this.isAdmin(t)&&!c.isadmin||c.id===e.id||e.id===t.admin),privilege:e.id===t.admin&&e.id!=c.id,out:t.admin!==c.id&&c.id!==e.id&&(this.isAdmin(t)&&!c.isadmin||e.id===t.admin)},c._style={statusTitle:t.admin!==c.id?c.isadmin?"管理员":"成员":"群主",statusClass:["fa-stack","member",c.isadmin?"admin":"",t.admin!==c.id?"":"owner",c.id!==e.id?"":"me"],privilegeClass:["fa","fa-level-"+(c.isadmin?"down":"up"),"fa-stack-1x"]}}}catch(t){a=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(a)throw r}}},orderMembers:function(t){var e=this.$store.state.user;t.list.sort(function(n,a){if(n.id===t.admin||a.id===t.admin)return n.id!==t.admin?1:-1;if(n.isadmin!=a.isadmin)return n.isadmin?-1:1;if(n.id===e.id||a.id===e.id)return n.id!==e.id?1:-1;for(var r=n.username,s=a.username,i=r.length>s.length?s.length:r.length,c=0;c<i;c++)if(r.charAt(c)!=s.charAt(c))return r.charAt(c)>s.charAt(c)?1:-1;return i!==r.length?1:-1})},isAdmin:function(t){var e=this.$store.state.user,n=!0,a=!1,r=void 0;try{for(var s,i=g()(t.list);!(n=(s=i.next()).done);n=!0){var c=s.value;if(e.id===c.id)return c.isadmin}}catch(t){a=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(a)throw r}}return!1}}},dt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"x-groupmgr"}},[t.error?n("div",[n("p",{staticStyle:{"text-align":"center","line-height":"128px","margin-top":"136px"}},[t._v(t._s(t.errorText))])]):null===t.contacts?n("div",[t._m(0)]):t.contacts.length?n("div",{staticClass:"px-0 mx-0 row",staticStyle:{height:"100%",width:"100%"}},[n("div",{staticClass:"col-md-5 position-relative",staticStyle:{"min-height":"75vh"}},[t._m(1),t._v(" "),n("ul",{staticClass:"nav flex-column nav-pills x-groupmgr-list"},t._l(t.contacts,function(e,a){return n("li",{key:e.id,staticClass:"nav-item",on:{click:function(e){return t.switchIndex(a)}}},[n("div",{class:["nav-link d-flex border flex-row justify-content-between align-items-center",a!==t.index?"":"active"],staticStyle:{cursor:"pointer"},attrs:{href:"javascript:;"}},[n("div",[t._v(t._s(e.groupname))]),t._v(" "),n("div",{},[e._operate.edit?n("span",{staticClass:"fa-stack",attrs:{title:"编辑群聊信息"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.editGroup(a)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-pencil fa-stack-1x"})]):t._e(),t._v(" "),e._operate.dismiss?n("span",{staticClass:"fa-stack",attrs:{title:"解散群聊"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.dismissGroup(a)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-trash fa-stack-1x"})]):t._e(),t._v(" "),t.$store.state.user.id!==e.admin?n("span",{staticClass:"fa-stack",attrs:{title:"退出群聊"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.leaveGroup(e)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-sign-out fa-stack-1x"})]):t._e()])])])}),0)]),t._v(" "),n("div",{staticClass:"col-md-7 position-relative",staticStyle:{"min-height":"75vh"}},[t._m(2),t._v(" "),n("ul",{staticClass:"list-group x-groupmgr-list"},t._l(t.contacts[t.index].list,function(e){return n("li",{key:e.id,staticClass:"list-group-item"},[n("div",{staticClass:"d-flex flex-row justify-content-between align-items-center"},[n("div",[t._v(t._s(e.username))]),t._v(" "),n("div",[e._operate.edit?n("span",{staticClass:"fa-stack",attrs:{title:"别名"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.renameMember(t.contacts[t.index].id,e)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-pencil fa-stack-1x"})]):t._e(),t._v(" "),n("span",{class:e._style.statusClass,attrs:{title:e._style.statusTitle}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-user fa-stack-1x"})]),t._v(" "),e._operate.privilege?n("span",{staticClass:"fa-stack",attrs:{title:e.isadmin?"变更成员":"提升管理"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.privilegeMember(t.contacts[t.index],e)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{class:e._style.privilegeClass})]):t._e(),t._v(" "),e._operate.out?n("span",{staticClass:"fa-stack",attrs:{title:"强制退出"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),t.removeMember(t.contacts[t.index],e)}}},[n("span",{staticClass:"fa fa-circle-thin fa-stack-2x"}),t._v(" "),n("span",{staticClass:"fa fa-trash fa-stack-1x"})]):t._e()])])])}),0)])]):n("div",[n("p",{staticStyle:{"text-align":"center","line-height":"128px"}},[t._v("还没有加入任何群聊.")])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticStyle:{"text-align":"center","line-height":"128px","margin-top":"136px"}},[e("span",{staticClass:"fa fa-spin fa-refresh mr-2"}),this._v("加载中...\n        ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"list-group"},[e("li",{staticClass:"list-group-item font-weight-bold text-center border-0"},[this._v("群聊列表")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"list-group"},[e("li",{staticClass:"list-group-item font-weight-bold text-center border-0"},[this._v("成员列表")])])}]};var ft=n("VU/8")(lt,dt,!1,function(t){n("rRAv")},null,null).exports,pt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:"x-absolute-center "+(this.background?"x-layer-rotate-background":"x-layer-rotate")},[e("span",{staticClass:"fa fa-cog fa-spin"}),this._v("\n    "+this._s(this.text)+"\n")])},staticRenderFns:[]};var mt=n("VU/8")({props:["text","background"]},pt,!1,function(t){n("Ya3L")},null,null).exports,vt={data:function(){return{tabs:[{text:"查找好友",key:"friends"},{text:"查找群聊",key:"groups"}],activeTab:"friends",data:null,no:1,count:50,refresh:!1,endReach:!1,keyword:"",friendGroup:[]}},beforeMount:function(){var t=this;R.getInstance().getFriendAndGroup().then(function(e){return t.friendGroup=e}).catch(function(t){console.error(t)})},methods:{onSwitchTab:function(t){var e=t.target.getAttribute("tab");this.activeTab=e,this.data=null,console.log(e)},onSearch:function(){this.refresh||(this.endReach=!1,this.no=1,this.pull())},pull:function(){var t=v()(p.a.mark(function t(e){var n,a,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.endReach&&!this.refresh){t.next=3;break}return this.endReach&&(this.refresh=!1),t.abrupt("return");case 3:if(this.refresh=!0,{},n="",t.prev=6,a=void 0,r=this.$store.state.user,"friends"===this.activeTab){t.next=15;break}return t.next=12,R.getInstance().getGroup(r.id,{keyword:this.keyword,no:this.no++,count:this.count});case 12:a=t.sent,t.next=18;break;case 15:return t.next=17,R.getInstance().getFriend(r.id,{no:this.no++,count:this.count,keyword:this.keyword});case 17:a=t.sent;case 18:this.no<=2?this.data=a:this.data=this.data.concat(a),a.length<this.count&&(this.endReach=!0),t.next=27;break;case 22:t.prev=22,t.t0=t.catch(6),n=t.t0.message,console.error(t.t0),layer.msg(n);case 27:return t.prev=27,this.refresh=!1,t.finish(27);case 30:case"end":return t.stop()}},t,this,[[6,22,27,30]])}));return function(e){return t.apply(this,arguments)}}(),onCreate:function(t){window.parent&&window.parent.postMessage({type:"layer",method:"open",options:{type:2,area:["360px","640px"],content:"http://"+location.host+"/im/index/newgroup"}},"*")},onClick:function(){var t=v()(p.a.mark(function t(e){var n,a,r,s,i,c=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",t.prev=1,a=this.$store.state.user,"groups"===this.activeTab){t.next=20;break}if(t.t0=this.friendGroup,t.t0){t.next=9;break}return t.next=8,R.getInstance().getFriendAndGroup();case 8:t.t0=this.friendGroup=t.sent;case 9:return r=t.t0,t.next=12,new d.a(function(t,e){c.$store.commit("layer/show",{title:"添加联系人",type:"contactAdd",list:r.map(function(t){return{text:t.groupname,value:t.id}}),onsubmit:function(e){return t(e)},oncancel:function(){return t(!1)}})});case 12:if(s=t.sent){t.next=15;break}return t.abrupt("return");case 15:return t.next=17,R.getInstance().addFriend(a.id,e,s.option,s.content);case 17:n=t.sent,t.next=28;break;case 20:return t.next=22,new d.a(function(t,e){c.$store.commit("layer/show",{title:"群聊申请",type:"contactAdd",list:null,onsubmit:function(e){return t(e)},oncancel:function(){return t(!1)}})});case 22:if(i=t.sent){t.next=25;break}return t.abrupt("return");case 25:return t.next=27,R.getInstance().joinGroup(a.id,e,i.content);case 27:n=t.sent;case 28:t.next=34;break;case 30:t.prev=30,t.t1=t.catch(1),console.error(t.t1),n=t.t1.message;case 34:layer.msg(n||"请求失败, 请稍后重试~");case 35:case"end":return t.stop()}},t,this,[[1,30]])}));return function(e){return t.apply(this,arguments)}}()},components:{"x-rotate":mt}},ht={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"x-search-contact"}},[n("ul",{staticClass:"nav nav-tabs"},t._l(t.tabs,function(e){return n("li",{key:e.key,staticClass:"nav-item"},[n("a",{class:["nav-link",t.activeTab!=e.key?"":"active"],attrs:{tab:e.key,href:"javascript:;"},on:{click:t.onSwitchTab}},[t._v(t._s(e.text))])])}),0),t._v(" "),n("form",{staticClass:"form my-4",on:{submit:function(e){return e.preventDefault(),t.onSearch(e)}}},[n("div",{staticClass:"form-group row mx-0"},[n("div",{staticClass:"col-8"},[n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.keyword,expression:"keyword",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入"+("groups"!=t.activeTab?"好友":"群聊")+"名称或 id 进行查找."},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),t._m(0)])]),t._v(" "),n("div",{staticClass:"x-fill",staticStyle:{top:"160px"}},[null===t.data?n("div",{staticClass:"mx-3 row"},[t._v("请输入关键字或 id 开始搜索.")]):0!==t.data.length?n("div",{staticClass:"mx-0 row"},[t._l(t.data,function(e,a){return n("div",{key:e.id,staticClass:"col-md-6 shadow-sm position-relative py-2 my-2",staticStyle:{overflow:"hidden"}},[n("div",{staticClass:"row",staticStyle:{width:"320px"}},[n("div",{staticClass:"col-4"},[n("img",{staticStyle:{width:"100%",height:"auto"},attrs:{src:e.avatar||"https://i.loli.net/2018/12/10/5c0de4003a282.png",alt:""}})]),t._v(" "),"groups"!==t.activeTab?n("div",{staticClass:"col-8"},[n("p",{staticClass:"my-0 py-1 text-truncate",attrs:{title:e.username}},[t._v("("+t._s(e.id)+") "+t._s(e.username))]),t._v(" "),n("p",{staticStyle:{margin:"0","font-size":"12px"}},[t._v("性别: "+t._s(e.sex))]),t._v(" "),n("p",{staticClass:"text-truncate",staticStyle:{margin:"0"}},[n("small",[t._v("签名: "+t._s(e.sign||"木有签名"))])])]):n("div",{staticClass:"col-8"},[n("p",{staticClass:"my-0 py-1 text-truncate",attrs:{title:e.groupname}},[t._v("("+t._s(e.id)+") "+t._s(e.groupname))]),t._v(" "),n("p",{staticStyle:{margin:"0","font-size":"12px"}},[t._v("人数: "+t._s(e.membercount))]),t._v(" "),n("p",{staticClass:"text-truncate",staticStyle:{margin:"0"}},[n("small",[t._v("描述: "+t._s(e.description))])])])]),t._v(" "),n("button",{staticClass:"btn btn-primary py-1 px-2",staticStyle:{"font-size":"12px",float:"right"},attrs:{"x-index":a},on:{click:function(n){return t.onClick(e.id)}}},[t._v(t._s("groups"!==t.activeTab?"添加好友":"加入群"))])])}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!this.endReach,expression:"!this.endReach"}],staticClass:"offset-2 col-8 my-4"},[n("button",{staticClass:"btn btn-block btn-primary",attrs:{type:"button"},on:{click:t.pull}},[t._v("加载更多")])])],2):n("div",{staticClass:"mx-3 row",staticStyle:{height:"200px"}},[n("p",{staticClass:"py-0 my-0",staticStyle:{"line-height":"200px","text-align":"center"}},[t._v("\n                没有找到符合搜索条件的"+t._s("friends"!==t.activeTab?"群组":"用户")+".\n                "),"friends"!=t.activeTab?n("a",{attrs:{href:"newgroup.html"},on:{click:function(e){return e.preventDefault(),t.onCreate(e)}}},[t._v("建立群组.")]):t._e()])])]),t._v(" "),n("x-rotate",{directives:[{name:"show",rawName:"v-show",value:this.refresh,expression:"this.refresh"}],attrs:{text:"加载中..."}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-4"},[e("button",{staticClass:"btn-block btn btn-primary",attrs:{type:"submit"}},[this._v("查找")])])}]};var gt=n("VU/8")(vt,ht,!1,function(t){n("l0Oy")},null,null).exports,xt={data:function(){return{avatar:"https://i.loli.net/2019/04/12/5cafffdaed88f.jpg",name:"",desc:""}},methods:{submit:function(){var t=v()(p.a.mark(function t(e){var n,a;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.avatar&&this.name&&this.desc){t.next=3;break}return y.a.msg("信息不能为空."),t.abrupt("return");case 3:return n="",t.prev=4,a=this.$store.state.user,t.next=8,R.getInstance().createGroup(a.id,{groupname:this.name,description:this.desc,avatar:this.avatar});case 8:n=t.sent,t.next=15;break;case 11:t.prev=11,t.t0=t.catch(4),n=t.t0.message,console.error(t.t0);case 15:y.a.msg(n);case 16:case"end":return t.stop()}},t,this,[[4,11]])}));return function(e){return t.apply(this,arguments)}}(),uploadFile:function(t){var e=this,n=this.$refs.avatar;if(n.value){var a=n.files[0];a&&A.getInstance().uploadAvatar(a).then(function(t){return e.avatar=t.src}).catch(function(t){return y.a.msg(t.message)}).finally(function(){return n.value=""})}}}},_t={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container py-3",attrs:{id:"x-group-new"}},[n("p",{staticClass:"font-weight-normal text-md-center",staticStyle:{"font-size":"18px"}},[t._v("新建群聊")]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 offset-md-2 col-md-8"},[n("form",{attrs:{method:"POST"},on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.submit(e)}}},[n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"groupname"}},[t._v("群聊名称:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.name,expression:"name",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{type:"text",name:"groupname"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"form-row"},[n("div",{staticClass:"col-md-2"},[n("label",{staticClass:"btn btn-primary",on:{click:function(e){return t.$refs.avatar.click()}}},[t._v("选取图像")])]),t._v(" "),n("div",{staticClass:"col-md-10"},[n("img",{staticStyle:{"max-width":"250px",width:"100%",margin:"auto"},attrs:{src:t.avatar,alt:"请先选择头像"},on:{click:function(e){return t.$refs.avatar.click()}}})]),t._v(" "),n("input",{ref:"avatar",staticClass:"d-none",attrs:{type:"file",accept:"image/png, image/jpeg"},on:{change:t.uploadFile}})]),t._v(" "),n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"description"}},[t._v("群聊描述:")]),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.desc,expression:"desc"}],staticClass:"form-control",attrs:{name:"description",rows:"3"},domProps:{value:t.desc},on:{input:function(e){e.target.composing||(t.desc=e.target.value)}}})]),t._v(" "),t._m(0)])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"form-row"},[e("input",{staticClass:"btn btn-primary btn-block offset-md-2 col-md-8",attrs:{type:"submit",value:"提交申请"}})])}]};var bt=n("VU/8")(xt,_t,!1,function(t){n("FaZw")},null,null).exports;a.a.use(H.a);var yt=new H.a({routes:[{path:"/videocall",name:"WebVideoCall",component:it},{path:"/contactmgr",name:"ContactMgr",component:et,children:[{path:"friend",component:ut},{path:"group",component:ft},{path:"find",component:gt},{path:"groupnew",component:bt}]},{path:"/",redirect:"/contactmgr"}]});yt.beforeEach(function(t,e,n){J.state.user?n():G()({method:"GET",url:F.userInfo}).then(function(t){var e=t.data;e.code?(J.commit("setUser",null),n(!1)):(J.commit("setUser",e.data),n())}).catch(function(t){n(!1)})});n("r7AC"),n("kXGG");G.a.defaults.baseURL="http://192.168.0.80:1235",G.a.defaults.withCredentials=!0,G.a.defaults.params={_ajax:!0},a.a.config.productionTip=!1,new a.a({el:"#app",router:yt,store:J,components:{App:z},template:"<App/>"})},OenY:function(t,e){},Q44U:function(t,e){},QdD9:function(t,e){},XpGk:function(t,e){},Ya3L:function(t,e){},"Zdx/":function(t,e){},daK1:function(t,e){},kXGG:function(t,e){},l0Oy:function(t,e){},r7AC:function(t,e){},rLTo:function(t,e){},rRAv:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.5656e1e0ffa9e63627af.js.map