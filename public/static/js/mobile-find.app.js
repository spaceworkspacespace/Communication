webpackJsonp([1],{"/WhO":function(t,e){},"5MlX":function(t,e){},"6Cqw":function(t,e){},"9WtT":function(t,e){t.exports=layer},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("7+uW"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var i=n("VU/8")({name:"App",beforeMount:function(){this.$store.dispatch("getUser")}},a,!1,function(t){n("6Cqw")},null,null).exports,s=n("/ocq"),o=n("BO1k"),u=n.n(o),c=n("gRE1"),l=n.n(c),d=n("Xxa5"),p=n.n(d),f=n("//Fk"),m=n.n(f),h=n("exGp"),v=n.n(h),g=n("mtWM"),_=n.n(g),b=(n("uKeQ"),n("9WtT")),y=n.n(b),x=n("Zrlr"),w=n.n(x),k=n("wxAW"),C=n.n(k),E=function(){function t(){w()(this,t)}return C()(t,[{key:"determineFriendGroupId",value:function(){var t=v()(p.a.mark(function t(e,n){var r,a,i,s,o,c,l,d,f;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_()({method:"GET",url:"/im/contact/friendgroup"}).then(function(t){if(t.data.code)throw new Error(t.data.msg||ERROR_MSG);return t.data.data});case 2:r=t.sent,a=null,i=!0,s=!1,o=void 0,t.prev=7,c=u()(r);case 9:if(i=(l=c.next()).done){t.next=17;break}if((d=l.value).group_name!==n){t.next=14;break}return a=d.id,t.abrupt("break",17);case 14:i=!0,t.next=9;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(7),s=!0,o=t.t0;case 23:t.prev=23,t.prev=24,!i&&c.return&&c.return();case 26:if(t.prev=26,!s){t.next=29;break}throw o;case 29:return t.finish(26);case 30:return t.finish(23);case 31:if(a){t.next=36;break}return t.next=34,_()({method:"POST",url:"/im/contact/friendgroup",params:{groupname:n}}).then(function(t){if(t.data.code)throw new Error(t.data.msg||ERROR_MSG);return t.data.data});case 34:f=t.sent,a=f.id;case 36:return t.abrupt("return",a);case 37:case"end":return t.stop()}},t,this,[[7,19,23,31],[24,,26,30]])}));return function(e,n){return t.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return t._instance||(t._instance=new t)}}]),t}();E._instance=null;var G={beforeMount:function(){this.pull()},data:function(){return{page:1,msgs:[],refresh:!1,endReach:!1}},methods:{accept:function(){var t=v()(p.a.mark(function t(e,n){var r,a,i,s,o,u=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,a=null,!n.group_id){t.next=6;break}a="/im/MsgBox/agreeGroup",r={sender_id:n.sender_id,send_ip:n.send_ip,group_id:n.group_id,sender_nickname:n.user.user_nickname},t.next=23;break;case 6:return a="/im/Msgbox/agreeFriends",i=null,t.next=10,new m.a(function(t,e){return y.a.prompt({title:"好友分组",value:"我的好友"},function(e,n){y.a.close(n),t(e.trim())})});case 10:return s=t.sent,o=this.$store.state.user,t.prev=12,t.next=15,E.getInstance().determineFriendGroupId(o.id,s);case 15:i=t.sent,t.next=22;break;case 18:return t.prev=18,t.t0=t.catch(12),y.a.msg(t.t0.message||"请求错误, 请稍后重试~"),t.abrupt("return");case 22:r={sender_id:n.sender_id,send_ip:n.send_ip,group_id_me:i,group_id_you:n.sender_friendgroup_id};case 23:_()({url:a,params:r}).then(function(t){t.data;u.msgs[e].agree="y"}).catch(function(t){y.a.msg("请求错误, 请稍后重试~"),console.error(t)});case 24:case"end":return t.stop()}},t,this,[[12,18]])}));return function(e,n){return t.apply(this,arguments)}}(),refuse:function(t,e){var n=this;_()({method:"GET",url:"/im/Msgbox/refuse",params:{sender_id:e}}).then(function(e){e.data;n.msgs[t].agree="n"}).catch(function(t){y.a.msg("请求错误, 请稍后重试~"),console.error(t)})},pull:function(){var t=this;this.endReach||this.refresh?this.endReach&&(this.refresh=!1):(this.refresh=!0,_()({method:"GET",url:"/im/Msgbox/data",params:{page:this.page++}}).then(function(e){var n=e.data;if(n.code)y.a.msg("请求错误, 请稍后重试~");else{var r=n.udata,a=n.data;a instanceof Array||(a=l()(a));var i=!0,s=!1,o=void 0;try{for(var c,d=u()(a);!(i=(c=d.next()).done);i=!0){var p=c.value,f=!0,m=!1,h=void 0;try{for(var v,g=u()(r);!(f=(v=g.next()).done);f=!0){var _=v.value;if(p.sender_id===_.id){p.user=_;break}}}catch(t){m=!0,h=t}finally{try{!f&&g.return&&g.return()}finally{if(m)throw h}}if(!p.user)return void y.a.msg("请求错误, 请稍后重试~")}}catch(t){s=!0,o=t}finally{try{!i&&d.return&&d.return()}finally{if(s)throw o}}t.page>2?t.msgs=t.msgs.concat(a):t.msgs=a}}).catch(function(t){y.a.msg("请求错误, 请稍后重试~"),console.error(t)}).finally(function(){t.refresh=!1}))},tryFill:function(){var t=this,e=this.$refs.content;e.scrollHeight<=e.clientHeight&&setTimeout(function(){return t.pull()},100)},onScroll:function(t){if(t.target===this.$refs.content){var e=t.target;e.scrollTop,e.clientHeight,e.scrollHeight}}}},R={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"newfriend"}},[n("header",{staticClass:"mui-bar mui-bar-nav"},[n("a",{staticClass:"mui-icon mui-icon-left-nav mui-pull-left",attrs:{href:"/im/index/index"}}),t._v(" "),n("router-link",{staticClass:"mui-pull-right",staticStyle:{height:"44px","line-height":"44px","font-size":"14px"},attrs:{to:"/add"}},[t._v("添加联系人")]),t._v(" "),n("h1",{staticClass:"mui-title"},[t._v("新的朋友")])],1),t._v(" "),n("div",{ref:"content",staticClass:"mui-content",staticStyle:{position:"absolute",top:"44px",bottom:"0",left:"0",right:"0",padding:"0","overflow-y":"auto"},on:{scroll:t.onScroll}},[n("ul",{staticClass:"mui-table-view"},t._l(t.msgs,function(e,r){return n("li",{key:r,staticClass:"mui-table-view-cell mui-media"},[n("a",{attrs:{href:"javascript:;"}},[n("img",{staticClass:"mui-media-object mui-pull-left",attrs:{src:e.user.avatar||"https://i.loli.net/2018/12/10/5c0de4003a282.png"}}),t._v(" "),"y"!=e.agree&&"n"!=e.agree?n("div",{staticClass:"mui-media-object mui-pull-right btn-group",staticStyle:{"max-width":"160px"}},[n("button",{attrs:{type:"button"},on:{click:function(n){t.accept(r,e)}}},[t._v("同意")]),t._v(" "),n("button",{attrs:{type:"button"},on:{click:function(n){t.refuse(r,e.sender_id)}}},[t._v("拒绝")])]):n("span",{staticClass:"mui-media-object mui-pull-right",staticStyle:{"font-size":"12px","max-width":"160px"}},[t._v("\n                        "+t._s("y"!==e.agree?"已拒绝":"已接受")+"\n                    ")]),t._v(" "),n("div",{staticClass:"mui-media-body"},[t._v("\n                        "+t._s(e.user.user_nickname)+"\n                        "),n("p",{staticClass:"mui-ellipsis"},[t._v(t._s(e.content))])])])])}),0)])])},staticRenderFns:[]};var S=n("VU/8")(G,R,!1,function(t){n("/WhO")},null,null).exports,T=n("d7EF"),M=n.n(T),j={beforeMount:function(){},data:function(){return{keyword:"",page:1,refresh:!1,endReach:!1,contacts:[],friendGroup:[]}},methods:{onAsk:function(){var t=v()(p.a.mark(function t(e,n){var r,a,i,s,o,c,l,d,f,h,v,g,b,y;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("",r=null,"group"===n){t.next=48;break}return t.prev=2,t.next=5,m.a.all([new m.a(function(t,e){return layer.prompt({title:"好友分组",value:"我的好友"},function(e,n){layer.close(n),t(e.trim())})}),_()({method:"GET",url:"/im/contact/friendgroup"}).then(function(t){if(t.data.code)throw new Error(t.data.msg||"请求错误, 请稍后重试~");return t.data.data})]);case 5:a=t.sent,i=M()(a,2),s=i[0],o=i[1],s,c=!0,l=!1,d=void 0,t.prev=13,f=u()(o);case 15:if(c=(h=f.next()).done){t.next=23;break}if((v=h.value).group_name!==s){t.next=20;break}return r=v.id,t.abrupt("break",23);case 20:c=!0,t.next=15;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(13),l=!0,d=t.t0;case 29:t.prev=29,t.prev=30,!c&&f.return&&f.return();case 32:if(t.prev=32,!l){t.next=35;break}throw d;case 35:return t.finish(32);case 36:return t.finish(29);case 37:if(r){t.next=42;break}return t.next=40,_()({method:"POST",url:"/im/contact/friendgroup",params:{groupname:s}}).then(function(t){if(t.data.code)throw new Error(t.data.msg||"请求错误, 请稍后重试~");return t.data.data});case 40:g=t.sent,r=g.id;case 42:t.next=48;break;case 44:return t.prev=44,t.t1=t.catch(2),layer.msg(t.t1.message||"请求错误, 请稍后重试~"),t.abrupt("return");case 48:if(t.prev=48,b=this.$store.state.user){t.next=53;break}throw this.$store.dispatch("getUser"),new Error("当前登录信息无效, 请稍后重试.");case 53:return t.next=55,new m.a(function(t,e){return layer.prompt({title:"验证信息",value:"我是"+b.user_nickname},function(e,n){layer.close(n),t(e.trim())})});case 55:return y=t.sent,t.next=58,_()({url:"/im/contact/"+("friend"!==n?"linkgroup":"linkfriend"),method:"POST",data:{id:e,content:y,friendGroupId:r}}).then(function(t){if(t.data.code)throw new Error(t.data.msg||"请求错误, 请稍后重试~");layer.msg(t.data.msg||"添加成功, 请等待对方确认.")});case 58:t.next=64;break;case 60:return t.prev=60,t.t2=t.catch(48),layer.msg(t.t2.message||"请求错误, 请稍后重试~"),t.abrupt("return");case 64:case"end":return t.stop()}},t,this,[[2,44],[13,25,29,37],[30,,32,36],[48,60]])}));return function(e,n){return t.apply(this,arguments)}}(),ask:function(t,e){},onRefresh:function(){this.page=1,this.onPull()},onPull:function(){var t=this;if(this.endReach||this.refresh)this.endReach&&(this.refresh=!1);else{this.refresh=!0;var e={keyword:this.keyword,page:this.page++};_.a.all([_()({method:"GET",url:"/im/contact/group",params:e}),_()({method:"GET",url:"/im/contact/user",params:e})]).then(function(e){var n=!0,r=!1,a=void 0;try{for(var i,s=u()(e);!(n=(i=s.next()).done);n=!0){var o=i.value;if(o.data.code)return void layer.msg(o.data.msg||"请求错误, 请稍后重试~")}}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}for(var c=e[0].data.data,l=e[1].data.data,d=c.length>l.length?l.length:c.length,p=[],f=0;f<d;f++)p.push((l[f]._type="friend",l[f])),p.push((c[f]._type="group",c[f]));p=c.length>l.length?p.concat(c.slice(d).map(function(t){return t._type="group",t})):p.concat(l.slice(d).map(function(t){return t._type="friend",t})),t.page>2?t.contacts=t.contacts.concat(p):t.contacts=p,console.log(t.contacts)}).catch(function(t){layer.msg("请求错误, 请稍后重试~"),console.error(t)}).finally(function(){t.refresh=!1})}}}},A={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"addcontact"}},[n("header",{staticClass:"mui-bar mui-bar-nav"},[n("a",{staticClass:"mui-icon mui-icon-left-nav mui-pull-left",on:{click:function(e){t.$router.back()}}}),t._v(" "),n("h1",{staticClass:"mui-title"},[t._v("添加好友")])]),t._v(" "),n("div",{staticClass:"mui-content",staticStyle:{position:"absolute",top:"44px",bottom:"0",left:"0",right:"0",padding:"0","overflow-y":"auto"}},[n("form",{staticClass:"mui-input-group",on:{submit:function(e){return e.preventDefault(),t.onRefresh(e)}}},[n("div",{staticClass:"mui-input-row"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],staticClass:"mui-input-clear",staticStyle:{width:"75%"},attrs:{type:"text",placeholder:"请输入关键字搜索"},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}}),t._v(" "),n("button",{staticClass:"mui-btn mui-btn-primary",staticStyle:{width:"25%"},attrs:{type:"submit"}},[t._v("确认")])])]),t._v(" "),n("ul",{staticClass:"mui-table-view"},t._l(t.contacts,function(e,r){return n("li",{key:r,staticClass:"mui-table-view-cell mui-media"},["group"!==e._type?n("a",{attrs:{href:"javascript:;"}},[n("img",{staticClass:"mui-media-object mui-pull-left",attrs:{src:e.avatar}}),t._v(" "),n("div",{staticClass:"mui-media-object mui-pull-right",staticStyle:{"max-width":"160px"}},[n("button",{on:{click:function(n){t.onAsk(e.id,e._type)}}},[t._v("申请好友")])]),t._v(" "),n("div",{staticClass:"mui-media-body"},[t._v("\n                        "+t._s(e.username)+"\n                        "),n("p",{staticClass:"mui-ellipsis"},[t._v(t._s(e.sign))])])]):n("a",{attrs:{href:"javascript:;"}},[n("img",{staticClass:"mui-media-object mui-pull-left",attrs:{src:e.avatar}}),t._v(" "),n("div",{staticClass:"mui-media-object mui-pull-right",staticStyle:{"max-width":"160px"}},[n("button",{on:{click:function(n){t.onAsk(e.id,e._type)}}},[t._v("申请入群")])]),t._v(" "),n("div",{staticClass:"mui-media-body"},[t._v("\n                        "+t._s(e.groupname)+"\n                        "),n("p",{staticClass:"mui-ellipsis"},[t._v(t._s(e.description))])])])])}),0)])])},staticRenderFns:[]};var F=n("VU/8")(j,A,!1,function(t){n("5MlX")},null,null).exports;r.a.use(s.a);var O=new s.a({routes:[{path:"/new",name:"NewFriend",component:S},{path:"/add",name:"AddContact",component:F},{path:"/",redirect:"/new"}]}),$=n("NYxO"),U={getUser:function(t){var e=t.commit;_()({method:"GET",url:"/im/user/info"}).then(function(t){t.data.code?(y.a.msg(t.data.msg||"获取用户信息失败."),e("setUser",null)):e("setUser",t.data.data)})}};r.a.use($.a);var P=new $.a.Store({actions:U,mutations:{setUser:function(t,e){t.user=e}},state:{user:null}});n("r7AC"),n("kXGG");_.a.defaults.params={_ajax:!0},r.a.config.productionTip=!1,new r.a({el:"#app",router:O,store:P,components:{App:i},template:"<App/>"})},kXGG:function(t,e){},r7AC:function(t,e){},uKeQ:function(t,e){t.exports=mui}},["NHnr"]);
//# sourceMappingURL=app.1439149ac88be2b61e22.js.map